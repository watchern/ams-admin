function Menubar(t,e){this.editorUi=t,this.container=e}function Menu(t,e){mxEventSource.call(this),this.funct=t,this.enabled=null!=e?e:!0}Menus=function(t){this.editorUi=t,this.menus=new Object,this.init(),mxClient.IS_SVG||((new Image).src=this.checkmarkImage)},Menus.prototype.defaultFont="Helvetica",Menus.prototype.defaultFontSize="12",Menus.prototype.defaultMenuItems=["file","edit","view","arrange","extras"],Menus.prototype.defaultFonts=["Helvetica","Verdana","Times New Roman","Garamond","Comic Sans MS","Courier New","Georgia","Lucida Console","Tahoma"],Menus.prototype.init=function(){var t=this.editorUi.editor.graph;mxUtils.bind(t,t.isEnabled);this.customFonts=[],this.customFontSizes=[],this.put("fontFamily",new Menu(mxUtils.bind(this,function(e,i){for(var n=mxUtils.bind(this,function(n){var r=this.styleChange(e,n,[mxConstants.STYLE_FONTFAMILY],[n],null,i,function(){document.execCommand("fontname",!1,n)},function(){t.updateLabelElements(t.getSelectionCells(),function(e){e.removeAttribute("face"),e.style.fontFamily=null,"PRE"==e.nodeName&&t.replaceElement(e,"div")})});r.firstChild.nextSibling.style.fontFamily=n}),r=0;r<this.defaultFonts.length;r++)n(this.defaultFonts[r]);if(e.addSeparator(i),this.customFonts.length>0){for(var r=0;r<this.customFonts.length;r++)n(this.customFonts[r]);e.addSeparator(i),e.addItem(mxResources.get("reset"),null,mxUtils.bind(this,function(){this.customFonts=[]}),i),e.addSeparator(i)}this.promptChange(e,mxResources.get("custom")+"...","",mxConstants.DEFAULT_FONTFAMILY,mxConstants.STYLE_FONTFAMILY,i,!0,mxUtils.bind(this,function(t){this.customFonts.push(t)}))}))),this.put("formatBlock",new Menu(mxUtils.bind(this,function(e,i){function n(n,r){return e.addItem(n,null,mxUtils.bind(this,function(){null!=t.cellEditor.textarea&&(t.cellEditor.textarea.focus(),document.execCommand("formatBlock",!1,"<"+r+">"))}),i)}n(mxResources.get("normal"),"p"),n("","h1").firstChild.nextSibling.innerHTML='<h1 style="margin:0px;">'+mxResources.get("heading")+" 1</h1>",n("","h2").firstChild.nextSibling.innerHTML='<h2 style="margin:0px;">'+mxResources.get("heading")+" 2</h2>",n("","h3").firstChild.nextSibling.innerHTML='<h3 style="margin:0px;">'+mxResources.get("heading")+" 3</h3>",n("","h4").firstChild.nextSibling.innerHTML='<h4 style="margin:0px;">'+mxResources.get("heading")+" 4</h4>",n("","h5").firstChild.nextSibling.innerHTML='<h5 style="margin:0px;">'+mxResources.get("heading")+" 5</h5>",n("","h6").firstChild.nextSibling.innerHTML='<h6 style="margin:0px;">'+mxResources.get("heading")+" 6</h6>",n("","pre").firstChild.nextSibling.innerHTML='<pre style="margin:0px;">'+mxResources.get("formatted")+"</pre>",n("","blockquote").firstChild.nextSibling.innerHTML='<blockquote style="margin-top:0px;margin-bottom:0px;">'+mxResources.get("blockquote")+"</blockquote>"}))),this.put("fontSize",new Menu(mxUtils.bind(this,function(e,i){for(var n=[6,8,9,10,11,12,14,18,24,36,48,72],r=mxUtils.bind(this,function(n){this.styleChange(e,n,[mxConstants.STYLE_FONTSIZE],[n],null,i,function(){document.execCommand("fontSize",!1,"3");for(var e=t.cellEditor.textarea.getElementsByTagName("font"),i=0;i<e.length;i++)if("3"==e[i].getAttribute("size")){e[i].removeAttribute("size"),e[i].style.fontSize=n+"px";break}})}),l=0;l<n.length;l++)r(n[l]);if(e.addSeparator(i),this.customFontSizes.length>0){for(var l=0;l<this.customFontSizes.length;l++)r(this.customFontSizes[l]);e.addSeparator(i),e.addItem(mxResources.get("reset"),null,mxUtils.bind(this,function(){this.customFontSizes=[]}),i),e.addSeparator(i)}}))),this.put("navigation",new Menu(mxUtils.bind(this,function(t,e){this.addMenuItems(t,["home","-","exitGroup","enterGroup","-","expand","collapse","-","collapsible"],e)}))),this.put("viewZoom",new Menu(mxUtils.bind(this,function(e,i){this.addMenuItems(e,["resetView","-"],i);for(var n=[.25,.5,.75,1,1.25,1.5,2,3,4],r=0;r<n.length;r++)!function(n){e.addItem(100*n+"%",null,function(){t.zoomTo(n)},i)}(n[r])})))},Menus.prototype.put=function(t,e){return this.menus[t]=e,e},Menus.prototype.get=function(t){return this.menus[t]},Menus.prototype.addSubmenu=function(t,e,i,n){var r=this.get(t);if(null!=r){var l=r.isEnabled();if(e.showDisabled||l){var a=e.addItem(n||mxResources.get(t),null,null,i,null,l);this.addMenu(t,e,a)}}},Menus.prototype.addMenu=function(t,e,i){var n=this.get(t);null!=n&&(e.showDisabled||n.isEnabled())&&this.get(t).execute(e,i)},Menus.prototype.edgeStyleChange=function(t,e,i,n,r,l,a){return t.addItem(e,null,mxUtils.bind(this,function(){var t=this.editorUi.editor.graph;t.stopEditing(!1),t.getModel().beginUpdate();try{for(var e=t.getSelectionCells(),r=[],l=0;l<e.length;l++){var o=e[l];if(t.getModel().isEdge(o)){if(a){var s=t.getCellGeometry(o);null!=s&&(s=s.clone(),s.points=null,t.getModel().setGeometry(o,s))}for(var h=0;h<i.length;h++)t.setCellStyles(i[h],n[h],[o]);r.push(o)}}this.editorUi.fireEvent(new mxEventObject("styleChanged","keys",i,"values",n,"cells",r))}finally{t.getModel().endUpdate()}}),l,r)},Menus.prototype.edgeLineStyleToChange=function(t,e,i){var n=this.editorUi.editor.graph;n.stopEditing(!1),n.getModel().beginUpdate();try{for(var r=n.getSelectionCells(),l=[],a=0;a<r.length;a++){var o=r[a];if(n.getModel().isEdge(o)){if(i){var s=n.getCellGeometry(o);null!=s&&(s=s.clone(),s.points=null,n.getModel().setGeometry(o,s))}for(var h=0;h<t.length;h++)n.setCellStyles(t[h],e[h],[o]);l.push(o)}}this.editorUi.fireEvent(new mxEventObject("styleChanged","keys",t,"values",e,"cells",l))}finally{n.getModel().endUpdate()}},Menus.prototype.styleChange=function(t,e,i,n,r,l,a,o){var s=this.createStyleChangeFunction(i,n);return t.addItem(e,null,mxUtils.bind(this,function(){var t=this.editorUi.editor.graph;null!=a&&t.cellEditor.isContentEditing()?a():s(o)}),l,r)},Menus.prototype.createStyleChangeFunction=function(t,e){return mxUtils.bind(this,function(i){var n=this.editorUi.editor.graph;n.stopEditing(!1),n.getModel().beginUpdate();try{for(var r=0;r<t.length;r++)n.setCellStyles(t[r],e[r]);null!=i&&i(),this.editorUi.fireEvent(new mxEventObject("styleChanged","keys",t,"values",e,"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}})},Menus.prototype.promptChange=function(t,e,i,n,r,l,a,o,s){return t.addItem(e,null,mxUtils.bind(this,function(){var t=this.editorUi.editor.graph,e=n,l=t.getView().getState(t.getSelectionCell());null!=l&&(e=l.style[r]||e);var a=new FilenameDialog(this.editorUi,e,mxResources.get("apply"),mxUtils.bind(this,function(e){if(null!=e&&e.length>0){t.getModel().beginUpdate();try{t.stopEditing(!1),t.setCellStyles(r,e)}finally{t.getModel().endUpdate()}null!=o&&o(e)}}),mxResources.get("enterValue")+(i.length>0?" "+i:""));this.editorUi.showDialog(a.container,300,80,!0,!0),a.init()}),l,s,a)},Menus.prototype.pickColor=function(t,e,i){var n=this.editorUi.editor.graph,r=226+17*(Math.ceil(ColorDialog.prototype.presetColors.length/12)+Math.ceil(ColorDialog.prototype.defaultColors.length/12));if(null!=e&&n.cellEditor.isContentEditing()){var l=n.cellEditor.saveSelection(),a=new ColorDialog(this.editorUi,i||"000000",mxUtils.bind(this,function(t){n.cellEditor.restoreSelection(l),document.execCommand(e,!1,t!=mxConstants.NONE?t:"transparent")}),function(){n.cellEditor.restoreSelection(l)});this.editorUi.showDialog(a.container,230,r,!0,!0),a.init()}else{null==this.colorDialog&&(this.colorDialog=new ColorDialog(this.editorUi)),this.colorDialog.currentColorKey=t;var o=n.getView().getState(n.getSelectionCell()),s="none";null!=o&&(s=o.style[t]||s),"none"==s?(s="ffffff",this.colorDialog.picker.fromString("ffffff"),this.colorDialog.colorInput.value="none"):this.colorDialog.picker.fromString(s),this.editorUi.showDialog(this.colorDialog.container,230,r,!0,!1),this.colorDialog.init()}},Menus.prototype.toggleStyle=function(t,e){var i=this.editorUi.editor.graph,n=i.toggleCellStyles(t,e);this.editorUi.fireEvent(new mxEventObject("styleChanged","keys",[t],"values",[n],"cells",i.getSelectionCells()))},Menus.prototype.addMenuItem=function(t,e,i,n,r,l){var a=this.editorUi.actions.get(e);if(null!=a&&(t.showDisabled||a.isEnabled())&&a.visible){var o=t.addItem(l||a.label,null,function(){a.funct(n)},i,r,a.isEnabled());return a.toggleAction&&a.isSelected()&&t.addCheckmark(o,Editor.checkmarkImage),this.addShortcut(o,a),o}return null},Menus.prototype.addShortcut=function(t,e){if(null!=e.shortcut){var i=t.firstChild.nextSibling.nextSibling,n=document.createElement("span");n.style.color="gray",mxUtils.write(n,e.shortcut),i.appendChild(n)}},Menus.prototype.addMenuItems=function(t,e,i,n,r){for(var l=0;l<e.length;l++)"-"==e[l]?t.addSeparator(i):this.addMenuItem(t,e[l],i,n,null!=r?r[l]:null)},Menus.prototype.createPopupMenu=function(t,e,i){var n=this.editorUi.editor.graph;if(t.smartSeparators=!0,n.curCell=e,n.isSelectionEmpty())this.addMenuItems(t,["selectVertices","selectEdges","selectAll","-","undo","redo","pasteHere"],null,i);else{var r=[];if(e.vertex){var l=this.createNodeMenus(e.nodeType,e.id);this.addMenuItems(t,l,null,i),n.canEditor&&(r=["-","cut","copy","delete"])}1==e.edge&&n.canEditor&&(-1!=e.style.indexOf("edgeStyle=orthogonalEdgeStyle")?this.addMenuItems(t,["switchLineStyleToStraight"],null,i):this.addMenuItems(t,["switchLineStyleToCurved"],null,i),this.addMenuItems(t,["reName"],null,i),r=["-","delete"]),this.addMenuItems(t,r,null,i)}},Menubar.prototype.addMenuHandler=function(t,e){if(null!=e){var i=!0,n=mxUtils.bind(this,function(n){if(i&&null==t.enabled||t.enabled){this.editorUi.editor.graph.popupMenuHandler.hideMenu();var r=new mxPopupMenu(e);r.div.className+=" geMenubarMenu",r.smartSeparators=!0,r.showDisabled=!0,r.autoExpand=!0,r.hideMenu=mxUtils.bind(this,function(){mxPopupMenu.prototype.hideMenu.apply(r,arguments),this.editorUi.resetCurrentMenu(),r.destroy()});var l=mxUtils.getOffset(t);r.popup(l.x,l.y+t.offsetHeight,null,n),this.editorUi.setCurrentMenu(r,t)}mxEvent.consume(n)});mxEvent.addListener(t,"mousemove",mxUtils.bind(this,function(e){null!=this.editorUi.currentMenu&&this.editorUi.currentMenuElt!=t&&(this.editorUi.hideCurrentMenu(),n(e))})),mxEvent.addListener(t,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(e){i=this.currentElt!=t,e.preventDefault()})),mxEvent.addListener(t,"click",mxUtils.bind(this,function(t){n(t),i=!0}))}},mxUtils.extend(Menu,mxEventSource),Menu.prototype.isEnabled=function(){return this.enabled},Menu.prototype.setEnabled=function(t){this.enabled!=t&&(this.enabled=t,this.fireEvent(new mxEventObject("stateChanged")))},Menu.prototype.execute=function(t,e){this.funct(t,e)},EditorUi.prototype.createMenus=function(){return new Menus(this)},Menus.prototype.createNodeMenus=function(t,e){var i=[];if(graph.canEditor===!1)return"datasource"===t?["previewNodeData","showCurNodeSQL"]:"newNullNode"===t?["executeNode","executeToNode","cancelExecute","previewNodeData","showCurNodeSQL"]:"barChart"===t?["barChartSet"]:["showCurNodeSQL"];switch(t){case"datasource":i=["previewNodeData","showCurNodeSQL","markCenterOutput","markFinalOutput","reName"];break;case"newNullNode":i=["executeNode","executeToNode","previewNodeData","showCurNodeSQL","-","cancelExecute","-","markCenterOutput","markFinalOutput","reName"];break;case"sql":i=["nullSqlEdit","showCurNodeSQL","reName"];break;case"filter":i=["filterSet","reSetOptProperty","showCurNodeSQL","reName"];break;case"sort":i=["sortSet","reSetOptProperty","showCurNodeSQL","reName"];break;case"layering":i=["layeringSet","reSetOptProperty","showCurNodeSQL","reName"];break;case"groupCount":i=["groupCountSet","reSetOptProperty","showCurNodeSQL","reName"];break;case"delRepeat":i=["delRepeatSet","reSetOptProperty","showCurNodeSQL","reName"];break;case"change":i=["changeSet","reSetOptProperty","showCurNodeSQL","reName"];break;case"union":i=["unionSet","reSetOptProperty","showCurNodeSQL","reName"];break;case"relation":i=["relationSet","reSetOptProperty","showCurNodeSQL","reName"];break;case"sample":i=["sampleSet","reSetOptProperty","showCurNodeSQL","reName"];break;case"comparison":i=["comparisonSet","reSetOptProperty","showCurNodeSQL","reName"];break;case"barChart":i=["barChartSet","reSetOptProperty","reName"]}return graph.nodeData[e].hasParam&&(i.push("-"),i.push("modifyParam")),i};