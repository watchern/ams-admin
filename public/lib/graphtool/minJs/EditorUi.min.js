function ChangePageSetup(e,t,i,n){this.ui=e,this.color=t,this.previousColor=t,this.image=i,this.previousImage=i,this.format=n,this.previousFormat=n,this.ignoreColor=!1,this.ignoreImage=!1}EditorUi=function(e,t,i){mxEventSource.call(this),this.destroyFunctions=[],this.editor=e||new Editor,this.container=t||document.getElementById("graphContainer");var n=this.editor.graph;n.useCssTransforms&&(this.lazyZoomDelay=0),this.editor.chromeless&&!this.editor.editable&&(n.isEnabled=function(){return!1},n.panningHandler.isForcePanningEvent=function(e){return!mxEvent.isPopupTrigger(e.getEvent())}),this.actions=new Actions(this),this.menus=this.createMenus(),this.createDivs(),this.createUi(),this.refresh();var r=mxUtils.bind(this,function(e){return null==e&&(e=window.event),this.isSelectionAllowed(e)||n.isEditing()});if(!this.editor.chromeless||this.editor.editable){var o=function(e){var t=mxEvent.getSource(e);if("A"==t.nodeName)for(;null!=t;){if("geHint"==t.className)return!0;t=t.parentNode}return r(e)};mxClient.IS_IE&&("undefined"==typeof document.documentMode||document.documentMode<9)?mxEvent.addListener(this.diagramContainer,"contextmenu",o):this.diagramContainer.oncontextmenu=o}else n.panningHandler.usePopupTrigger=!1;if(n.init(this.diagramContainer),mxClient.IS_SVG&&null!=n.view.getDrawPane()){var a=n.view.getDrawPane().ownerSVGElement;null!=a&&(a.style.position="absolute")}this.hoverIcons=this.createHoverIcons(),mxEvent.addListener(this.diagramContainer,"mousemove",mxUtils.bind(this,function(e){var t=mxUtils.getOffset(this.diagramContainer);mxEvent.getClientX(e)-t.x-this.diagramContainer.clientWidth>0||mxEvent.getClientY(e)-t.y-this.diagramContainer.clientHeight>0?this.diagramContainer.setAttribute("title",mxResources.get("panTooltip")):this.diagramContainer.removeAttribute("title")}));var s=!1,l=this.hoverIcons.isResetEvent;this.hoverIcons.isResetEvent=function(e,t){return s||l.apply(this,arguments)},this.keydownHandler=mxUtils.bind(this,function(e){32==e.which?(s=!0,this.hoverIcons.reset(),n.container.style.cursor="move",n.isEditing()||mxEvent.getSource(e)!=n.container||mxEvent.consume(e)):mxEvent.isConsumed(e)||27!=e.keyCode||this.hideDialog()}),mxEvent.addListener(document,"keydown",this.keydownHandler),this.keyupHandler=mxUtils.bind(this,function(e){n.container.style.cursor="",s=!1}),mxEvent.addListener(document,"keyup",this.keyupHandler);var d=n.panningHandler.isForcePanningEvent;n.panningHandler.isForcePanningEvent=function(e){return d.apply(this,arguments)||s||mxEvent.isMouseEvent(e.getEvent())&&(this.usePopupTrigger||!mxEvent.isPopupTrigger(e.getEvent()))&&(!mxEvent.isControlDown(e.getEvent())&&mxEvent.isRightMouseButton(e.getEvent())||mxEvent.isMiddleMouseButton(e.getEvent()))};var h=n.cellEditor.isStopEditingEvent;n.cellEditor.isStopEditingEvent=function(e){return h.apply(this,arguments)||13==e.keyCode&&(!mxClient.IS_SF&&mxEvent.isControlDown(e)||mxClient.IS_MAC&&mxEvent.isMetaDown(e)||mxClient.IS_SF&&mxEvent.isShiftDown(e))};var c=this,g=n.cellEditor.startEditing;n.cellEditor.startEditing=function(){if(g.apply(this,arguments),n.cellEditor.isContentEditing()){var e=!1,t=function(){e||(e=!0,window.setTimeout(function(){for(var t=n.getSelectedElement(),i=t;null!=i&&i.nodeType!=mxConstants.NODETYPE_ELEMENT;)i=i.parentNode;if(null!=i){var r=mxUtils.getCurrentStyle(i);if(null!=r&&null!=c.toolbar){var o=r.fontFamily;"'"==o.charAt(0)&&(o=o.substring(1)),"'"==o.charAt(o.length-1)&&(o=o.substring(0,o.length-1)),c.toolbar.setFontName(o),c.toolbar.setFontSize(parseInt(r.fontSize))}}e=!1},0))};mxEvent.addListener(n.cellEditor.textarea,"input",t),mxEvent.addListener(n.cellEditor.textarea,"touchend",t),mxEvent.addListener(n.cellEditor.textarea,"mouseup",t),mxEvent.addListener(n.cellEditor.textarea,"keyup",t),t()}};var u=n.cellEditor.stopEditing;if(n.cellEditor.stopEditing=function(e,t){u.apply(this,arguments)},n.container.setAttribute("tabindex","0"),n.container.style.cursor="default",window.self===window.top&&null!=n.container.parentNode)try{n.container.focus()}catch(p){}var m=n.fireMouseEvent;n.fireMouseEvent=function(e,t,i){if(e==mxEvent.MOUSE_DOWN){this.container.focus(),n.curCell=void 0==t.sourceState?null:t.sourceState.cell;try{n.curCell&&"undefined"!=typeof n.curCell.referedNodeId&&(n.curCell=n.model.cells[n.curCell.referedNodeId]),initNodeDetail()}catch(r){}}m.apply(this,arguments)},n.popupMenuHandler.autoExpand=!0,null!=this.menus&&(n.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(e,t,i){this.menus.createPopupMenu(e,t,i)})),mxEvent.addGestureListeners(document,mxUtils.bind(this,function(e){n.popupMenuHandler.hideMenu()})),this.keyHandler=this.createKeyHandler(e),this.getKeyHandler=function(){return keyHandler};for(var v=["rounded","shadow","glass","dashed","dashPattern","comic","labelBackgroundColor"],f=["shape","edgeStyle","curved","rounded","elbow","comic","jumpStyle","jumpSize"],E=["fontFamily","fontSize","fontColor"],y=["edgeStyle","startArrow","startFill","startSize","endArrow","endFill","endSize","jettySize","orthogonalLoop"],x=[["startArrow","startFill","startSize","sourcePerimeterSpacing","endArrow","endFill","endSize","targetPerimeterSpacing","jettySize","orthogonalLoop"],["strokeColor","strokeWidth"],["fillColor","gradientColor"],E,["opacity"],["align"],["html"]],S=0;S<x.length;S++)for(var C=0;C<x[S].length;C++)v.push(x[S][C]);for(var S=0;S<f.length;S++)mxUtils.indexOf(v,f[S])<0&&v.push(f[S]);var w=function(e,t){var i=n.getModel();i.beginUpdate();try{if(t)for(var r=i.isEdge(h),o=r?n.currentEdgeStyle:n.currentVertexStyle,a=["fontSize","fontFamily","fontColor"],s=0;s<a.length;s++){var l=o[a[s]];null!=l&&n.setCellStyles(a[s],l,e)}else for(var d=0;d<e.length;d++){for(var h=e[d],c=i.getStyle(h),g=null!=c?c.split(";"):[],u=v.slice(),s=0;s<g.length;s++){var p=g[s],m=p.indexOf("=");if(m>=0){var E=p.substring(0,m),y=mxUtils.indexOf(u,E);y>=0&&u.splice(y,1);for(var S=0;S<x.length;S++){var C=x[S];if(mxUtils.indexOf(C,E)>=0)for(var w=0;w<C.length;w++){var b=mxUtils.indexOf(u,C[w]);b>=0&&u.splice(b,1)}}}}for(var r=i.isEdge(h),o=r?n.currentEdgeStyle:n.currentVertexStyle,M=i.getStyle(h),s=0;s<u.length;s++){var E=u[s],U=o[E];null==U||"shape"==E&&!r||(!r||mxUtils.indexOf(f,E)<0)&&(M=mxUtils.setStyle(M,E,U))}i.setStyle(h,M)}}finally{i.endUpdate()}};if(n.addListener("cellsInserted",function(e,t){w(t.getProperty("cells"))}),n.addListener("textInserted",function(e,t){w(t.getProperty("cells"),!0)}),n.connectionHandler.addListener(mxEvent.CONNECT,function(e,t){var i=[t.getProperty("cell")];t.getProperty("terminalInserted")&&i.push(t.getProperty("terminal")),w(i)}),this.addListener("styleChanged",mxUtils.bind(this,function(e,t){var i=t.getProperty("cells"),r=!1,o=!1;if(i.length>0)for(var a=0;a<i.length&&(r=n.getModel().isVertex(i[a])||r,o=n.getModel().isEdge(i[a])||o,!o||!r);a++);else r=!0,o=!0;for(var s=t.getProperty("keys"),l=t.getProperty("values"),a=0;a<s.length;a++){var d=mxUtils.indexOf(E,s[a])>=0;("strokeColor"!=s[a]||null!=l[a]&&"none"!=l[a])&&(mxUtils.indexOf(f,s[a])>=0?o||mxUtils.indexOf(y,s[a])>=0?null==l[a]?delete n.currentEdgeStyle[s[a]]:n.currentEdgeStyle[s[a]]=l[a]:r&&mxUtils.indexOf(v,s[a])>=0&&(null==l[a]?delete n.currentVertexStyle[s[a]]:n.currentVertexStyle[s[a]]=l[a]):mxUtils.indexOf(v,s[a])>=0&&((r||d)&&(null==l[a]?delete n.currentVertexStyle[s[a]]:n.currentVertexStyle[s[a]]=l[a]),(o||d||mxUtils.indexOf(y,s[a])>=0)&&(null==l[a]?delete n.currentEdgeStyle[s[a]]:n.currentEdgeStyle[s[a]]=l[a])))}if(null!=this.toolbar){if(this.toolbar.setFontName(n.currentVertexStyle.fontFamily||Menus.prototype.defaultFont),this.toolbar.setFontSize(n.currentVertexStyle.fontSize||Menus.prototype.defaultFontSize),null!=this.toolbar.edgeStyleMenu){var h=this.toolbar.edgeStyleMenu.getElementsByTagName("div")[0];"orthogonalEdgeStyle"==n.currentEdgeStyle.edgeStyle&&"1"==n.currentEdgeStyle.curved?h.className="geSprite geSprite-curved":"straight"==n.currentEdgeStyle.edgeStyle||"none"==n.currentEdgeStyle.edgeStyle||null==n.currentEdgeStyle.edgeStyle?h.className="geSprite geSprite-straight":"entityRelationEdgeStyle"==n.currentEdgeStyle.edgeStyle?h.className="geSprite geSprite-entity":"elbowEdgeStyle"==n.currentEdgeStyle.edgeStyle?h.className="geSprite geSprite-"+("vertical"==n.currentEdgeStyle.elbow?"verticalelbow":"horizontalelbow"):"isometricEdgeStyle"==n.currentEdgeStyle.edgeStyle?h.className="geSprite geSprite-"+("vertical"==n.currentEdgeStyle.elbow?"verticalisometric":"horizontalisometric"):h.className="geSprite geSprite-orthogonal"}if(null!=this.toolbar.edgeShapeMenu){var c=this.toolbar.edgeShapeMenu.getElementsByTagName("div")[0];"link"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-linkedge":"flexArrow"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-arrow":"arrow"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-simplearrow":c.className="geSprite geSprite-connection"}if(null!=this.toolbar.lineStartMenu){var g=this.toolbar.lineStartMenu.getElementsByTagName("div")[0];g.className=this.getCssClassForMarker("start",n.currentEdgeStyle.shape,n.currentEdgeStyle[mxConstants.STYLE_STARTARROW],mxUtils.getValue(n.currentEdgeStyle,"startFill","1"))}if(null!=this.toolbar.lineEndMenu){var u=this.toolbar.lineEndMenu.getElementsByTagName("div")[0];u.className=this.getCssClassForMarker("end",n.currentEdgeStyle.shape,n.currentEdgeStyle[mxConstants.STYLE_ENDARROW],mxUtils.getValue(n.currentEdgeStyle,"endFill","1"))}}})),null!=this.toolbar){var b=mxUtils.bind(this,function(){var e=n.currentVertexStyle.fontFamily||"Helvetica",t=String(n.currentVertexStyle.fontSize||"12"),i=n.getView().getState(n.getSelectionCell());null!=i&&(e=i.style[mxConstants.STYLE_FONTFAMILY]||e,t=i.style[mxConstants.STYLE_FONTSIZE]||t,e.length>10&&(e=e.substring(0,8)+"...")),this.toolbar.setFontName(e),this.toolbar.setFontSize(t)});n.getSelectionModel().addListener(mxEvent.CHANGE,b),n.getModel().addListener(mxEvent.CHANGE,b)}return n.addListener(mxEvent.CELLS_ADDED,function(e,t){var i=t.getProperty("cells"),r=t.getProperty("parent");n.getModel().isLayer(r)&&!n.isCellVisible(r)&&null!=i&&i.length>0&&n.getModel().setVisible(r,!0)}),this.gestureHandler=mxUtils.bind(this,function(e){null!=this.currentMenu&&mxEvent.getSource(e)!=this.currentMenu.div&&this.hideCurrentMenu()}),mxEvent.addGestureListeners(document,this.gestureHandler),this.resizeHandler=mxUtils.bind(this,function(){window.setTimeout(mxUtils.bind(this,function(){null!=this.editor.graph&&this.refresh()}),0)}),mxEvent.addListener(window,"resize",this.resizeHandler),this.orientationChangeHandler=mxUtils.bind(this,function(){this.refresh()}),mxEvent.addListener(window,"orientationchange",this.orientationChangeHandler),mxClient.IS_IOS&&!window.navigator.standalone&&(this.scrollHandler=mxUtils.bind(this,function(){window.scrollTo(0,0)}),mxEvent.addListener(window,"scroll",this.scrollHandler)),this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.resetScrollbars()})),this.addListener("gridEnabledChanged",mxUtils.bind(this,function(){n.view.validateBackground()})),this.addListener("backgroundColorChanged",mxUtils.bind(this,function(){n.view.validateBackground()})),n.addListener("gridSizeChanged",mxUtils.bind(this,function(){n.isGridEnabled()&&n.view.validateBackground()})),this.editor.resetGraph(),this.init(),this.open(),n.preExeGetFields=function(e,t){var i=!1;return $.ajax({type:"post",url:"/data/tableMeta/createViewAndGetCols",dataType:"json",async:!1,data:{tableMetaUuid:t.id,isEnclose:"1"},beforeSend:function(e){},success:function(t){var r=3;if(null==t.data)i=!0,alert("获取数据表【"+e.value+"】信息失败,无法创建数据表节点"),r=4;else{for(var o=[],a="SELECT",s=0;s<t.data.length;s++){var l=null===t.data[s].chnName||""===t.data[s].chnName?t.data[s].colName:t.data[s].chnName,d=l;o.push({columnName:l,columnType:t.data[s].dataType,columnLength:t.data[s].dataLength,isOutputColumn:1,newColumnName:d}),a+=s===t.data.length-1?d:" "+d+","}a+=" FROM "+t.data[0].viewName,n.nodeData[e.id].nodeInfo.resultTableName=t.data[0].viewName,n.nodeData[e.id].nodeInfo.nodeSql=a,n.nodeData[e.id].columnsInfo=o}n.nodeData[e.id].nodeInfo.nodeExcuteStatus=r}}),i},this},mxUtils.extend(EditorUi,mxEventSource),EditorUi.compactUi=!0,EditorUi.prototype.splitSize=(mxClient.IS_TOUCH||mxClient.IS_POINTER,6),EditorUi.prototype.sidebarWidth=240,EditorUi.prototype.resultHeight=335,EditorUi.prototype.resultContentHeight=225,EditorUi.prototype.scrollBarHeight=0,EditorUi.prototype.detailContainerWidth=300,EditorUi.prototype.leftMenuWidth=0,EditorUi.prototype.formatWidth=240,EditorUi.prototype.toolbarHeight=120,EditorUi.prototype.allowAnimation=!0,EditorUi.prototype.init=function(){var e=this.editor.graph;mxEvent.addListener(e.container,"keydown",mxUtils.bind(this,function(e){this.onKeyDown(e)})),mxEvent.addListener(e.container,"keypress",mxUtils.bind(this,function(e){this.onKeyPress(e)})),this.addUndoListener(),this.addBeforeUnloadListener(),e.getSelectionModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()})),e.getModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()}));var t=e.setDefaultParent,i=this;this.editor.graph.setDefaultParent=function(){t.apply(this,arguments),i.updateActionStates()},this.updateActionStates(),this.initClipboard(),this.initCanvas(),null!=this.format&&this.format.init()},EditorUi.prototype.onKeyDown=function(e){var t=this.editor.graph;9==e.which&&t.isEnabled()&&!mxEvent.isAltDown(e)&&(t.isEditing()?t.stopEditing(!1):t.selectCell(!mxEvent.isShiftDown(e)),mxEvent.consume(e))},EditorUi.prototype.onKeyPress=function(e){var t=this.editor.graph;if(this.isImmediateEditingEvent(e)&&!t.isEditing()&&!t.isSelectionEmpty()&&0!==e.which&&!mxEvent.isAltDown(e)&&!mxEvent.isControlDown(e)&&!mxEvent.isMetaDown(e)&&(t.escape(),t.startEditing(),mxClient.IS_FF)){var i=t.cellEditor;i.textarea.innerHTML=String.fromCharCode(e.which);var n=document.createRange();n.selectNodeContents(i.textarea),n.collapse(!1);var r=window.getSelection();r.removeAllRanges(),r.addRange(n)}},EditorUi.prototype.isImmediateEditingEvent=function(e){return!0},EditorUi.prototype.getCssClassForMarker=function(e,t,i,n){var r="";return r="flexArrow"==t?null!=i&&i!=mxConstants.NONE?"geSprite geSprite-"+e+"blocktrans":"geSprite geSprite-noarrow":i==mxConstants.ARROW_CLASSIC?"1"==n?"geSprite geSprite-"+e+"classic":"geSprite geSprite-"+e+"classictrans":i==mxConstants.ARROW_CLASSIC_THIN?"1"==n?"geSprite geSprite-"+e+"classicthin":"geSprite geSprite-"+e+"classicthintrans":i==mxConstants.ARROW_OPEN?"geSprite geSprite-"+e+"open":i==mxConstants.ARROW_OPEN_THIN?"geSprite geSprite-"+e+"openthin":i==mxConstants.ARROW_BLOCK?"1"==n?"geSprite geSprite-"+e+"block":"geSprite geSprite-"+e+"blocktrans":i==mxConstants.ARROW_BLOCK_THIN?"1"==n?"geSprite geSprite-"+e+"blockthin":"geSprite geSprite-"+e+"blockthintrans":i==mxConstants.ARROW_OVAL?"1"==n?"geSprite geSprite-"+e+"oval":"geSprite geSprite-"+e+"ovaltrans":i==mxConstants.ARROW_DIAMOND?"1"==n?"geSprite geSprite-"+e+"diamond":"geSprite geSprite-"+e+"diamondtrans":i==mxConstants.ARROW_DIAMOND_THIN?"1"==n?"geSprite geSprite-"+e+"thindiamond":"geSprite geSprite-"+e+"thindiamondtrans":"openAsync"==i?"geSprite geSprite-"+e+"openasync":"dash"==i?"geSprite geSprite-"+e+"dash":"cross"==i?"geSprite geSprite-"+e+"cross":"async"==i?"1"==n?"geSprite geSprite-"+e+"async":"geSprite geSprite-"+e+"asynctrans":"circle"==i||"circlePlus"==i?"1"==n||"circle"==i?"geSprite geSprite-"+e+"circle":"geSprite geSprite-"+e+"circleplus":"ERone"==i?"geSprite geSprite-"+e+"erone":"ERmandOne"==i?"geSprite geSprite-"+e+"eronetoone":"ERmany"==i?"geSprite geSprite-"+e+"ermany":"ERoneToMany"==i?"geSprite geSprite-"+e+"eronetomany":"ERzeroToOne"==i?"geSprite geSprite-"+e+"eroneopt":"ERzeroToMany"==i?"geSprite geSprite-"+e+"ermanyopt":"geSprite geSprite-noarrow"},EditorUi.prototype.createMenus=function(){return null},EditorUi.prototype.updatePasteActionStates=function(){var e=this.editor.graph,t=this.actions.get("paste");t.setEnabled(this.editor.graph.cellEditor.isContentEditing()||!mxClipboard.isEmpty()&&e.isEnabled()&&!e.isCellLocked(e.getDefaultParent()))},EditorUi.prototype.initClipboard=function(){var e=this,t=mxClipboard.cut;mxClipboard.cut=function(i){i.cellEditor.isContentEditing()?document.execCommand("cut",!1,null):t.apply(this,arguments),e.updatePasteActionStates()};var i=mxClipboard.copy;mxClipboard.copy=function(t){t.cellEditor.isContentEditing()?document.execCommand("copy",!1,null):i.apply(this,arguments),e.updatePasteActionStates()};var n=mxClipboard.paste;mxClipboard.paste=function(t){var i=null;return t.cellEditor.isContentEditing()?document.execCommand("paste",!1,null):i=n.apply(this,arguments),e.updatePasteActionStates(),i};var r=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){r.apply(this,arguments),e.updatePasteActionStates()};var o=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(t,i){o.apply(this,arguments),e.updatePasteActionStates()},this.updatePasteActionStates()},EditorUi.prototype.lazyZoomDelay=20,EditorUi.prototype.initCanvas=function(){var e=this.editor.graph;e.timerAutoScroll=!0,e.getPagePadding=function(){return new mxPoint(Math.max(0,Math.round(0)),Math.max(0,Math.round(0)))},e.view.getBackgroundPageBounds=function(){var e=this.graph.getPageLayout(),t=this.graph.getPageSize();return new mxRectangle(this.scale*(this.translate.x+e.x*t.width),this.scale*(this.translate.y+e.y*t.height),this.scale*e.width*t.width,this.scale*e.height*t.height)},e.getPreferredPageSize=function(e,t,i){var n=this.getPageLayout(),r=this.getPageSize();return new mxRectangle(0,0,n.width*r.width,n.height*r.height)};var t=null,i=this;if(this.editor.extendCanvas){var n=e.view.validate;e.view.validate=function(){if(null!=this.graph.container&&mxUtils.hasScrollbars(this.graph.container)){var e=this.graph.getPagePadding(),t=this.graph.getPageSize();this.translate.x,this.translate.y;this.translate.x=e.x-(this.x0||0)*t.width,this.translate.y=e.y-(this.y0||0)*t.height}n.apply(this,arguments)};var r=e.sizeDidChange;e.sizeDidChange=function(){if(null!=this.container&&mxUtils.hasScrollbars(this.container)){var t=this.getPageLayout(),i=this.getPagePadding(),n=this.getPageSize(),o=Math.ceil(2*i.x+t.width*n.width),a=Math.ceil(2*i.y+t.height*n.height),s=e.minimumGraphSize;(null==s||s.width!=o||s.height!=a)&&(e.minimumGraphSize=new mxRectangle(0,0,o,a));var l=i.x-t.x*n.width,d=i.y-t.y*n.height;if(!this.autoTranslate&&(this.view.translate.x!=l||this.view.translate.y!=d)){this.autoTranslate=!0,this.view.x0=t.x,this.view.y0=t.y;var h=e.view.translate.x,c=e.view.translate.y;return e.view.setTranslate(l,d),e.container.scrollLeft+=Math.round((l-h)*e.view.scale),e.container.scrollTop+=Math.round((d-c)*e.view.scale),void(this.autoTranslate=!1)}r.apply(this,arguments)}}}e.updateZoomTimeout=null,e.cumulativeZoomFactor=1;var o=null;e.lazyZoom=function(n){null!=this.updateZoomTimeout&&window.clearTimeout(this.updateZoomTimeout),n?this.view.scale*this.cumulativeZoomFactor<.15?this.cumulativeZoomFactor=(this.view.scale+.01)/this.view.scale:(this.cumulativeZoomFactor*=this.zoomFactor,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale):this.view.scale*this.cumulativeZoomFactor<=.15?this.cumulativeZoomFactor=(this.view.scale-.01)/this.view.scale:(this.cumulativeZoomFactor/=this.zoomFactor,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale),this.cumulativeZoomFactor=Math.max(.01,Math.min(this.view.scale*this.cumulativeZoomFactor,160)/this.view.scale),this.updateZoomTimeout=window.setTimeout(mxUtils.bind(this,function(){var n=mxUtils.getOffset(e.container),r=0,a=0;null!=o&&(r=e.container.offsetWidth/2-o.x+n.x,a=e.container.offsetHeight/2-o.y+n.y);var s=this.view.scale;this.zoom(this.cumulativeZoomFactor);var l=this.view.scale;l!=s&&(null!=t&&i.chromelessResize(!1,null,r*(this.cumulativeZoomFactor-1),a*(this.cumulativeZoomFactor-1)),!mxUtils.hasScrollbars(e.container)||0==r&&0==a||(e.container.scrollLeft-=r*(this.cumulativeZoomFactor-1),e.container.scrollTop-=a*(this.cumulativeZoomFactor-1))),this.cumulativeZoomFactor=1,this.updateZoomTimeout=null}),this.lazyZoomDelay)},mxEvent.addMouseWheelListener(mxUtils.bind(this,function(t,i){if((null==this.dialogs||0==this.dialogs.length)&&e.isZoomWheelEvent(t))for(var n=mxEvent.getSource(t);null!=n;){if(n==e.container)return o=new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t)),e.lazyZoom(i),void mxEvent.consume(t);n=n.parentNode}}))},EditorUi.prototype.isSelectionAllowed=function(e){return"SELECT"==mxEvent.getSource(e).nodeName||"INPUT"==mxEvent.getSource(e).nodeName&&mxUtils.isAncestorNode(null,mxEvent.getSource(e))},EditorUi.prototype.addBeforeUnloadListener=function(){window.onbeforeunload=mxUtils.bind(this,function(){return this.onBeforeUnload()})},EditorUi.prototype.onBeforeUnload=function(){},EditorUi.prototype.open=function(){this.editor.graph.view.validate(),this.editor.graph.sizeDidChange(),this.editor.fireEvent(new mxEventObject("resetGraphView"))},EditorUi.prototype.setCurrentMenu=function(e,t){this.currentMenuElt=t,this.currentMenu=e},EditorUi.prototype.resetCurrentMenu=function(){this.currentMenuElt=null,this.currentMenu=null},EditorUi.prototype.hideCurrentMenu=function(){null!=this.currentMenu&&(this.currentMenu.hideMenu(),this.resetCurrentMenu())},EditorUi.prototype.createHoverIcons=function(){return new HoverIcons(this.editor.graph)},EditorUi.prototype.redo=function(){try{var e=this.editor.graph;e.isEditing()?document.execCommand("redo",!1,null):this.editor.undoManager.redo()}catch(t){}},EditorUi.prototype.undo=function(){try{var e=this.editor.graph;if(e.isEditing()){var t=e.cellEditor.textarea.innerHTML;document.execCommand("undo",!1,null),t==e.cellEditor.textarea.innerHTML&&(e.stopEditing(!0),this.editor.undoManager.undo())}else this.editor.undoManager.undo()}catch(i){}},EditorUi.prototype.canRedo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canRedo()},EditorUi.prototype.canUndo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canUndo()},EditorUi.prototype.getEditBlankXml=function(){return mxUtils.getXml(this.editor.getGraphXml())},EditorUi.prototype.getUrl=function(e){var t=null!=e?e:window.location.pathname,i=t.indexOf("?")>0?1:0;for(var n in urlParams)t+=0==i?"?":"&",t+=n+"="+urlParams[n],i++;return t},EditorUi.prototype.setScrollbars=function(e){var t=this.editor.graph,i=t.container.style.overflow;if(t.scrollbars=e,this.editor.updateGraphComponents(),i!=t.container.style.overflow)if("hidden"==t.container.style.overflow){var n=t.view.translate;t.view.setTranslate(n.x-t.container.scrollLeft/t.view.scale,n.y-t.container.scrollTop/t.view.scale),t.container.scrollLeft=0,t.container.scrollTop=0,t.minimumGraphSize=null,t.sizeDidChange()}else{var r=t.view.translate.x,o=t.view.translate.y;t.view.translate.x=0,t.view.translate.y=0,t.sizeDidChange(),t.container.scrollLeft-=Math.round(r*t.view.scale),t.container.scrollTop-=Math.round(o*t.view.scale)}this.fireEvent(new mxEventObject("scrollbarsChanged"))},EditorUi.prototype.hasScrollbars=function(){return this.editor.graph.scrollbars},EditorUi.prototype.resetScrollbars=function(){var e=this.editor.graph;if(this.editor.extendCanvas)if(mxUtils.hasScrollbars(e.container))if(e.pageVisible){var t=e.getPagePadding();e.container.scrollTop=Math.floor(t.y-this.editor.initialTopSpacing)-1,e.container.scrollLeft=Math.floor(Math.min(t.x,(e.container.scrollWidth-e.container.clientWidth)/2))-1;var i=e.getGraphBounds();i.width>0&&i.height>0&&(i.x>e.container.scrollLeft+.9*e.container.clientWidth&&(e.container.scrollLeft=Math.min(i.x+i.width-e.container.clientWidth,i.x-10)),i.y>e.container.scrollTop+.9*e.container.clientHeight&&(e.container.scrollTop=Math.min(i.y+i.height-e.container.clientHeight,i.y-10)))}else{var i=e.getGraphBounds(),n=Math.max(i.width,e.scrollTileSize.width*e.view.scale),r=Math.max(i.height,e.scrollTileSize.height*e.view.scale);e.container.scrollTop=Math.floor(Math.max(0,i.y-Math.max(20,(e.container.clientHeight-r)/4))),e.container.scrollLeft=Math.floor(Math.max(0,i.x-Math.max(0,(e.container.clientWidth-n)/2)))}else if(e.pageVisible){var o=e.view.getBackgroundPageBounds();e.view.setTranslate(Math.floor(Math.max(0,(e.container.clientWidth-o.width)/2)-o.x),Math.floor(Math.max(0,(e.container.clientHeight-o.height)/2)-o.y))}else{var i=e.getGraphBounds();e.view.setTranslate(Math.floor(Math.max(0,Math.max(0,(e.container.clientWidth-i.width)/2)-i.x)),Math.floor(Math.max(0,Math.max(20,(e.container.clientHeight-i.height)/4))-i.y))}},EditorUi.prototype.setPageVisible=function(e){var t=this.editor.graph,i=mxUtils.hasScrollbars(t.container),n=0,r=0;if(i&&(n=t.view.translate.x*t.view.scale-t.container.scrollLeft,r=t.view.translate.y*t.view.scale-t.container.scrollTop),t.pageVisible=e,t.pageBreaksVisible=e,t.preferPageSize=e,t.view.validateBackground(),i){var o=t.getSelectionCells();t.clearSelection(),t.setSelectionCells(o)}t.sizeDidChange(),i&&(t.container.scrollLeft=t.view.translate.x*t.view.scale-n,t.container.scrollTop=t.view.translate.y*t.view.scale-r),this.fireEvent(new mxEventObject("pageViewChanged"))},ChangePageSetup.prototype.execute=function(){var e,t=this.ui.editor.graph;this.ignoreColor||(this.color=this.previousColor,e=t.background,this.ui.setBackgroundColor(this.previousColor),this.previousColor=e),this.ignoreImage||(this.image=this.previousImage,e=t.backgroundImage,this.ui.setBackgroundImage(this.previousImage),this.previousImage=e),null!=this.previousFormat&&(this.format=this.previousFormat,e=t.pageFormat,(this.previousFormat.width!=e.width||this.previousFormat.height!=e.height)&&(this.ui.setPageFormat(this.previousFormat),this.previousFormat=e)),null!=this.foldingEnabled&&this.foldingEnabled!=this.ui.editor.graph.foldingEnabled&&(this.ui.setFoldingEnabled(this.foldingEnabled),this.foldingEnabled=!this.foldingEnabled)},function(){var e=new mxObjectCodec(new ChangePageSetup,["ui","previousColor","previousImage","previousFormat"]);e.afterDecode=function(e,t,i){return i.previousColor=i.color,i.previousImage=i.image,i.previousFormat=i.format,null!=i.foldingEnabled&&(i.foldingEnabled=!i.foldingEnabled),i},mxCodecRegistry.register(e)}(),EditorUi.prototype.setBackgroundColor=function(e){this.editor.graph.background=e,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("backgroundColorChanged"))},EditorUi.prototype.setFoldingEnabled=function(e){this.editor.graph.foldingEnabled=e,this.editor.graph.view.revalidate(),this.fireEvent(new mxEventObject("foldingEnabledChanged"))},EditorUi.prototype.setPageFormat=function(e){this.editor.graph.pageFormat=e,this.editor.graph.pageVisible?(this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange()):this.actions.get("pageView").funct(),this.fireEvent(new mxEventObject("pageFormatChanged"))},EditorUi.prototype.setPageScale=function(e){this.editor.graph.pageScale=e,this.editor.graph.pageVisible?(this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange()):this.actions.get("pageView").funct(),this.fireEvent(new mxEventObject("pageScaleChanged"))},EditorUi.prototype.setGridColor=function(e){this.editor.graph.view.gridColor=e,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("gridColorChanged"))},EditorUi.prototype.addUndoListener=function(){var e=this.actions.get("undo"),t=this.actions.get("redo"),i=this.editor.undoManager,n=mxUtils.bind(this,function(){e.setEnabled(this.canUndo()),t.setEnabled(this.canRedo())});i.addListener(mxEvent.ADD,n),i.addListener(mxEvent.UNDO,n),i.addListener(mxEvent.REDO,n),i.addListener(mxEvent.CLEAR,n);var r=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){r.apply(this,arguments),n()};var o=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(e,t){o.apply(this,arguments),n()},n()},EditorUi.prototype.updateActionStates=function(){var e=this.editor.graph,t=!e.isSelectionEmpty(),i=!1,n=!1,r=e.getSelectionCells();if(null!=r)for(var o=0;o<r.length;o++){var a=r[o];if(e.getModel().isEdge(a)&&(n=!0),e.getModel().isVertex(a)&&(i=!0),n&&i)break}for(var s=["cut","copy","delete"],o=0;o<s.length;o++)this.actions.get(s[o]).setEnabled(t);this.actions.get("turn").setEnabled(!e.isSelectionEmpty()),this.actions.get("curved").setEnabled(n);var l=i&&1==e.getSelectionCount();this.actions.get("group").setEnabled(e.getSelectionCount()>1||l&&!e.isContainer(e.getSelectionCell())),this.actions.get("ungroup").setEnabled(1==e.getSelectionCount()&&(e.getModel().getChildCount(e.getSelectionCell())>0||l&&e.isContainer(e.getSelectionCell()))),this.actions.get("removeFromGroup").setEnabled(l&&e.getModel().isVertex(e.getModel().getParent(e.getSelectionCell())));e.view.getState(e.getSelectionCell()),1==e.getSelectionCount()&&e.isCellFoldable(e.getSelectionCell());this.actions.get("guides").setEnabled(e.isEnabled()),this.actions.get("grid").setEnabled(!this.editor.chromeless||this.editor.editable);var d=e.isEnabled()&&!e.isCellLocked(e.getDefaultParent());this.actions.get("selectVertices").setEnabled(d),this.actions.get("selectEdges").setEnabled(d),this.actions.get("selectAll").setEnabled(d),this.actions.get("selectNone").setEnabled(d),this.updatePasteActionStates()},EditorUi.prototype.refresh=function(e){var t=(this.container.clientWidth,this.container.clientHeight);mxClient.IS_IOS&&!window.navigator.standalone&&window.innerHeight!==document.documentElement.clientHeight&&window.scrollTo(0,0);var i=this.graphToolDiv.clientWidth;this.hsplitPosition="undefined"!=typeof this.hsplitPosition?this.hsplitPosition:this.sidebarWidth;var n=Math.max(0,Math.min(this.hsplitPosition,i-this.splitSize-20));this.sidebarContainer&&(this.sidebarContainer.style.width=n+"px"),this.sidebarContainer.style.height=t+"px",this.container.style.width=$(this.graphToolDiv).width()-this.hsplitPosition-this.detailContainerWidth-this.splitSize+"px",this.vsplit.style.left=$(this.sidebarContainer).width()+this.splitSize+"px",this.vsplit.style.width=$(this.graphToolDiv).width()-this.hsplitPosition-this.detailContainerWidth-this.splitSize+"px",this.detailContainer.style.height=this.sidebarContainer.style.height,this.detailContainer.style.bottom=this.sidebarContainer.style.height,this.container.style.left=n+this.splitSize+"px",this.hsplit.style.left=n+"px"},EditorUi.prototype.refreshv=function(e){var t=document.documentElement.clientHeight,i=Math.max(1,Math.min(this.vsplitPosition,t-200)),n=this.container.clientHeight-this.toolbarContainer.clientHeight;i=n>i?i:n,this.resultContainer.style.height=i-60+"px",this.diagramContainer.style.bottom=i+this.splitSize-60+"px",this.vsplit.style.bottom=i+"px",this.tableArea.style.height=i-110+"px",this.sysInfoArea.style.height=i-110+"px",this.outLineArea.style.height=i-110+"px"},EditorUi.prototype.createDivs=function(){this.graphToolDiv=document.getElementById("graphToolDiv"),this.sidebarContainer=document.getElementById("accordion"),this.toolbarContainer=document.getElementById("geToolbarContainer"),this.diagramContainer=document.getElementById("geDiagramContainer"),this.backgroundPage=document.getElementById("geBackgroundPage"),this.detailContainer=document.getElementById("detailContainer"),this.resultContainer=document.getElementById("geResultContainer"),this.tableArea=document.getElementById("tableArea"),this.sysInfoArea=document.getElementById("sysInfoArea"),this.outLineArea=document.getElementById("outLineArea"),this.hsplit=document.getElementById("geHsplit"),this.vsplit=document.getElementById("geVsplit"),this.leftMenuWidth=$(this.graphToolDiv).offset().left;var e=$(this.graphToolDiv).height()-this.toolbarHeight+10;this.sidebarContainer.style.width=this.sidebarWidth+"px",this.resultContainer.style.height=this.resultHeight-60+"px",this.container.style.left=this.sidebarWidth+this.splitSize+"px",this.container.style.right=this.detailContainerWidth+15+"px",
this.container.style.width=$(this.graphToolDiv).width()-this.sidebarWidth-this.splitSize-this.detailContainerWidth+"px",this.container.style.height=e+"px",this.diagramContainer.style.bottom=this.resultHeight-60+"px",this.detailContainer.style.width=this.detailContainerWidth+"px",this.hsplit.style.width=this.splitSize+"px",this.hsplit.style.bottom=e+"px",this.hsplit.style.height=e+"px",this.hsplit.style.left=this.sidebarWidth+"px",this.vsplit.style.width=$(this.graphToolDiv).width()-this.sidebarWidth-this.splitSize-this.detailContainerWidth+"px",this.vsplit.style.height=this.splitSize+"px",this.vsplit.style.bottom=this.resultHeight+"px",this.vsplit.style.left=this.sidebarWidth+$(this.graphToolDiv).offset().left+this.splitSize+"px",this.tableArea.style.height=this.resultContentHeight+"px",this.sysInfoArea.style.height=this.resultContentHeight+"px",this.outLineArea.style.height=this.resultContentHeight+"px"},EditorUi.prototype.createUi=function(){var e=document.body.clientWidth;this.container.appendChild(this.diagramContainer),null!=this.container&&null!=this.tabContainer&&this.container.appendChild(this.tabContainer),null!=this.toolbar&&(this.toolbarContainer.appendChild(this.toolbar.container),this.container.appendChild(this.toolbarContainer)),null!=this.hsplit&&this.addSplitHandler(this.hsplit,!0,0,mxUtils.bind(this,function(t){var i=e-this.sidebarWidth-this.splitSize-500;i>t&&t>this.sidebarWidth&&(this.hsplitPosition=t),this.refresh()})),null!=this.vsplit&&this.addSplitHandler(this.vsplit,!1,0,mxUtils.bind(this,function(e){e>150&&(this.vsplitPosition=e),this.refreshv()}))},EditorUi.prototype.createDiv=function(e){var t=document.createElement("div");return t.className=e,t},EditorUi.prototype.addSplitHandler=function(e,t,i,n){function r(e){if(null!=a){var r=new mxPoint(mxEvent.getClientX(e),mxEvent.getClientY(e));n(Math.max(0,s+(t?r.x-a.x:a.y-r.y)-i)),mxEvent.consume(e),s!==h()&&(l=!0,d=null)}}function o(e){r(e),s=null,a=null}var a=null,s=null,l=!0,d=null;mxClient.IS_POINTER&&(e.style.touchAction="none");var h=mxUtils.bind(this,function(){return parseInt(t?e.style.left:e.style.bottom)});mxEvent.addGestureListeners(e,function(e){a=new mxPoint(mxEvent.getClientX(e),mxEvent.getClientY(e)),s=h(),l=!1,mxEvent.consume(e)}),mxEvent.addGestureListeners(document,null,r,o),this.destroyFunctions.push(function(){mxEvent.removeGestureListeners(document,null,r,o)})},EditorUi.prototype.showDialog=function(e,t,i,n,r,o,a,s){this.editor.graph.tooltipHandler.hideTooltip(),null==this.dialogs&&(this.dialogs=[]),this.dialog=new Dialog(this,e,t,i,n,r,o,a,s),this.dialogs.push(this.dialog)},EditorUi.prototype.hideDialog=function(e){if(null!=this.dialogs&&this.dialogs.length>0){var t=this.dialogs.pop();t.close(e),this.dialog=this.dialogs.length>0?this.dialogs[this.dialogs.length-1]:null,null==this.dialog&&"hidden"!=this.editor.graph.container.style.visibility&&this.editor.graph.container.focus(),mxUtils.clearSelection(),this.editor.fireEvent(new mxEventObject("hideDialog"))}},EditorUi.prototype.pickColor=function(e,t){var i=this.editor.graph,n=i.cellEditor.saveSelection(),r=226+17*(Math.ceil(ColorDialog.prototype.presetColors.length/12)+Math.ceil(ColorDialog.prototype.defaultColors.length/12)),o=new ColorDialog(this,e||"none",function(e){i.cellEditor.restoreSelection(n),t(e)},function(){i.cellEditor.restoreSelection(n)});this.showDialog(o.container,230,r,!0,!1),o.init()},EditorUi.prototype.executeLayout=function(e,t,i){var n=this.editor.graph;if(n.isEnabled()){n.getModel().beginUpdate();try{e()}catch(r){throw r}finally{if(this.allowAnimation&&t&&navigator.userAgent.indexOf("Camino")<0){var o=new mxMorphing(n);o.addListener(mxEvent.DONE,mxUtils.bind(this,function(){n.getModel().endUpdate(),null!=i&&i()})),o.startAnimation()}else n.getModel().endUpdate(),null!=i&&i()}}},EditorUi.prototype.showImageDialog=function(e,t,i,n){var r=this.editor.graph.cellEditor,o=r.saveSelection(),a=mxUtils.prompt(e,t);if(r.restoreSelection(o),null!=a&&a.length>0){var s=new Image;s.onload=function(){i(a,s.width,s.height)},s.onerror=function(){i(null),mxUtils.alert(mxResources.get("fileNotFound"))},s.src=a}else i(null)},EditorUi.prototype.showLinkDialog=function(e,t,i){var n=new LinkDialog(this,e,t,i);this.showDialog(n.container,420,90,!0,!0),n.init()},EditorUi.prototype.showDataDialog=function(e){if(null!=e){var t=new EditDataDialog(this,e);this.showDialog(t.container,340,340,!0,!1,null,!1),t.init()}},EditorUi.prototype.showBackgroundImageDialog=function(e){e=null!=e?e:mxUtils.bind(this,function(e){var t=new ChangePageSetup(this,null,e);t.ignoreColor=!0,this.editor.graph.model.execute(t)});var t=mxUtils.prompt(mxResources.get("backgroundImage"),"");if(null!=t&&t.length>0){var i=new Image;i.onload=function(){e(new mxImage(t,i.width,i.height))},i.onerror=function(){e(null),mxUtils.alert(mxResources.get("fileNotFound"))},i.src=t}else e(null)},EditorUi.prototype.setBackgroundImage=function(e){this.editor.graph.setBackgroundImage(e),this.editor.graph.view.validateBackgroundImage(),this.fireEvent(new mxEventObject("backgroundImageChanged"))},EditorUi.prototype.confirm=function(e,t,i){mxUtils.confirm(e)?null!=t&&t():null!=i&&i()},EditorUi.prototype.createOutline=function(e){var t=new mxOutline(this.editor.graph);return t.border=20,mxEvent.addListener(window,"resize",function(){t.update()}),this.addListener("pageFormatChanged",function(){t.update()}),t},EditorUi.prototype.createKeyHandler=function(e){function t(e,t,i){a.push(function(){if(!n.isSelectionEmpty()&&n.isEnabled())if(t=null!=t?t:1,i){n.getModel().beginUpdate();try{for(var r=n.getSelectionCells(),o=0;o<r.length;o++)if(n.getModel().isVertex(r[o])&&n.isCellResizable(r[o])){var a=n.getCellGeometry(r[o]);null!=a&&(a=a.clone(),37==e?a.width=Math.max(0,a.width-t):38==e?a.height=Math.max(0,a.height-t):39==e?a.width+=t:40==e&&(a.height+=t),n.getModel().setGeometry(r[o],a))}}finally{n.getModel().endUpdate()}}else{var s=n.getSelectionCell(),l=n.model.getParent(s),d=null;if(1==n.getSelectionCount()&&n.model.isVertex(s)&&null!=n.layoutManager&&!n.isCellLocked(s)&&(d=n.layoutManager.getLayout(l)),null!=d&&d.constructor==mxStackLayout){var h=l.getIndex(s);37==e||38==e?n.model.add(l,s,Math.max(0,h-1)):(39==e||40==e)&&n.model.add(l,s,Math.min(n.model.getChildCount(l),h+1))}else{var c=0,g=0;37==e?c=-t:38==e?g=-t:39==e?c=t:40==e&&(g=t),n.moveCells(n.getMovableCells(n.getSelectionCells()),c,g)}}}),null!=s&&window.clearTimeout(s),s=window.setTimeout(function(){if(a.length>0){n.getModel().beginUpdate();try{for(var e=0;e<a.length;e++)a[e]();a=[]}finally{n.getModel().endUpdate()}n.scrollCellToVisible(n.getSelectionCell())}},200)}var i=this,n=this.editor.graph,r=new mxKeyHandler(n),o=r.isEventIgnored;r.isEventIgnored=function(e){return(!this.isControlDown(e)||mxEvent.isShiftDown(e)||90!=e.keyCode&&89!=e.keyCode&&188!=e.keyCode&&190!=e.keyCode&&85!=e.keyCode)&&(66!=e.keyCode&&73!=e.keyCode||!this.isControlDown(e)||this.graph.cellEditor.isContentEditing()&&!mxClient.IS_FF&&!mxClient.IS_SF)&&o.apply(this,arguments)},r.isEnabledForEvent=function(e){return!mxEvent.isConsumed(e)&&this.isGraphEvent(e)&&this.isEnabled()&&(null==i.dialogs||0==i.dialogs.length)},r.isControlDown=function(e){return mxEvent.isControlDown(e)||mxClient.IS_MAC&&e.metaKey};var a=[],s=null,l={37:mxConstants.DIRECTION_WEST,38:mxConstants.DIRECTION_NORTH,39:mxConstants.DIRECTION_EAST,40:mxConstants.DIRECTION_SOUTH},d=r.getFunction;mxKeyHandler.prototype.getFunction=function(e){if(n.isEnabled()){if(mxEvent.isShiftDown(e)&&mxEvent.isAltDown(e)){var r=i.actions.get(i.altShiftActions[e.keyCode]);if(null!=r)return r.funct}if(9==e.keyCode&&mxEvent.isAltDown(e))return mxEvent.isShiftDown(e)?function(){n.selectParentCell()}:function(){n.selectChildCell()};if(null!=l[e.keyCode]&&!n.isSelectionEmpty()){if(!mxEvent.isShiftDown(e)||!mxEvent.isAltDown(e))return this.isControlDown(e)?function(){t(e.keyCode,mxEvent.isShiftDown(e)?n.gridSize:null,!0)}:function(){t(e.keyCode,mxEvent.isShiftDown(e)?n.gridSize:null)};if(n.model.isVertex(n.getSelectionCell()))return function(){var t=n.connectVertex(n.getSelectionCell(),l[e.keyCode],n.defaultEdgeLength,e,!0);null!=t&&t.length>0&&(1==t.length&&n.model.isEdge(t[0])?n.setSelectionCell(n.model.getTerminal(t[0],!1)):n.setSelectionCell(t[t.length-1]),n.scrollCellToVisible(n.getSelectionCell()),null!=i.hoverIcons&&i.hoverIcons.update(n.view.getState(n.getSelectionCell())))}}}return d.apply(this,arguments)},r.bindAction=mxUtils.bind(this,function(e,t,i,n){var o=this.actions.get(i);if(null!=o){var a=function(){o.isEnabled()&&o.funct()};t?n?r.bindControlShiftKey(e,a):r.bindControlKey(e,a):n?r.bindShiftKey(e,a):r.bindKey(e,a)}});var h=r.escape;return r.escape=function(e){h.apply(this,arguments)},r.enter=function(){},r},EditorUi.prototype.destroy=function(){if(null!=this.editor&&(this.editor.destroy(),this.editor=null),null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),null!=this.sidebar&&(this.sidebar.destroy(),this.sidebar=null),null!=this.keyHandler&&(this.keyHandler.destroy(),this.keyHandler=null),null!=this.keydownHandler&&(mxEvent.removeListener(document,"keydown",this.keydownHandler),this.keydownHandler=null),null!=this.keyupHandler&&(mxEvent.removeListener(document,"keyup",this.keyupHandler),this.keyupHandler=null),null!=this.resizeHandler&&(mxEvent.removeListener(window,"resize",this.resizeHandler),this.resizeHandler=null),null!=this.gestureHandler&&(mxEvent.removeGestureListeners(document,this.gestureHandler),this.gestureHandler=null),null!=this.orientationChangeHandler&&(mxEvent.removeListener(window,"orientationchange",this.orientationChangeHandler),this.orientationChangeHandler=null),null!=this.scrollHandler&&(mxEvent.removeListener(window,"scroll",this.scrollHandler),this.scrollHandler=null),null!=this.destroyFunctions){for(var e=0;e<this.destroyFunctions.length;e++)this.destroyFunctions[e]();this.destroyFunctions=null}for(var t=[this.toolbarContainer,this.diagramContainer,this.chromelessToolbar,this.hsplit,this.layersDialog],e=0;e<t.length;e++)null!=t[e]&&null!=t[e].parentNode&&t[e].parentNode.removeChild(t[e])},EditorUi.prototype.resetHistory=function(){this.editor.undoManager.clear(),this.editor.graph.oldOptArr=[],this.editor.graph.newOptArr=[],this.editor.graph.edgeArr=[]};var topAreaHide=!1,leftAreaHide=!1,rightAreaHide=!1,old_toolbar_height,old_leftArea_width,old_rightArea_width;EditorUi.prototype.toolBarH_S=function(){var e=$("#detailContainer"),t=$("#accordion"),i=$("#graphContainer"),n=$("#geHsplit"),r=$("#geToolbarContainer");topAreaHide?($("#geToolbarContainer>.menu").show(),$("#H_S_Menu>ul>li:eq(0)").html("折叠上方区域"),$("#geToolbarContainer").height(old_toolbar_height+"px"),e.css({height:e.height()-90+"px",bottom:e.height()-90+"px"}),t.css({height:t.height()-90+"px"}),i.css({height:i.height()-90+"px"}),n.css({height:n.height()-90+"px",bottom:n.height()-90+"px"}),this.toolbarHeight=120,topAreaHide=!1):(old_toolbar_height=r.height(),$("#geToolbarContainer>.menu").hide(),$("#H_S_Menu>ul>li:eq(0)").html("展开上方区域"),r.height("20px"),e.css({height:e.height()+90+"px",bottom:e.height()+90+"px"}),t.css({height:t.height()+90+"px"}),i.css({height:i.height()+90+"px"}),n.css({height:n.height()+90+"px",bottom:n.height()+90+"px"}),this.toolbarHeight=30,topAreaHide=!0)},EditorUi.prototype.leftAreaH_S=function(){var e=$("#accordion"),t=$("#geHsplit"),i=$("#geVsplit"),n=$("#graphContainer"),r=n.position().left;leftAreaHide?(e.show(),t.show(),$("#H_S_Menu>ul>li:eq(1)").html("折叠左侧区域"),n.css({width:n.width()-old_leftArea_width-this.splitSize+"px",left:old_leftArea_width+this.splitSize+"px"}),i.css({width:i.width()-old_leftArea_width-this.splitSize+"px",left:r+old_leftArea_width+this.splitSize+"px"}),this.hsplitPosition=old_leftArea_width+this.splitSize,leftAreaHide=!1):(old_leftArea_width=e.width(),e.hide(),t.hide(),$("#H_S_Menu>ul>li:eq(1)").html("展开左侧区域"),n.css({width:n.width()+old_leftArea_width+this.splitSize+"px",left:"0"}),i.css({width:i.width()+old_leftArea_width+this.splitSize+"px",left:r-old_leftArea_width-this.splitSize+"px"}),this.hsplitPosition=0,leftAreaHide=!0)},EditorUi.prototype.rightAreaH_S=function(){var e=$("#detailContainer"),t=$("#geVsplit"),i=$("#graphContainer");i.position().left;rightAreaHide?(e.show(),$("#H_S_Menu>ul>li:eq(2)").html("折叠右侧区域"),i.css({width:i.width()-old_rightArea_width+"px",right:old_rightArea_width+15+"px"}),t.css({width:t.width()-old_rightArea_width+"px"}),rightAreaHide=!1):(old_rightArea_width=e.width(),e.hide(),$("#H_S_Menu>ul>li:eq(2)").html("展开右侧区域"),i.css({width:i.width()+old_rightArea_width+"px",right:"14px"}),t.css({width:t.width()+old_rightArea_width+"px"}),rightAreaHide=!0)};var iconDrag=function(e){var t=getDataSourceTable(),i=!1;$.inArray(e.name,t)>-1&&(i=!0);var n=function(t,n,r,o,a){var s=createCellShape(e.type,i),l=new mxCell(e.english?e.english:e.name,new mxGeometry(0,0,60,80),s);l.vertex=!0,l.nodeType=e.type;var d={id:l.id,name:e.name,type:e.type,english:e.english||""};initNodeData(d,!0);var h=t.importCells([l],o,a,r);t.curCell=l;var c="拖入【"+e.name+"】";if("datasource"===l.nodeType){if(t.nodeData[l.id].treeNodeId=e.id,t.isCreateTableNodeError=t.preExeGetFields(l,e),t.isCreateTableNodeError)return t.oldOptArr.push({optType:"drag",optArr:[{id:l.id,nodeData:t.nodeData[l.id]}]}),ownerEditor.editor.undoManager.undo(),ownerEditor.editor.undoManager.history.pop(),void delete t.isCreateTableNodeError;i&&(setDataSourceCopyIcon(l.id),t.nodeData[l.id].isCopy=!0),c="拖入表【"+e.name+"】"}if(t.oldOptArr.push({optType:"drag",optArr:[{id:l.id,nodeData:t.nodeData[l.id]}]}),refrashResourceZtree(l.id,e.name,l.nodeType),refrashHistoryZtree(c),autoSaveGraph(),t.getModel().root.children[0].children.length>=2){var g=t.getModel().root.children[0].children[t.getModel().root.children[0].children.length-2];g.nodeType||(g=t.getModel().root.children[0].children[t.getModel().root.children[0].children.length-3]);var u=h[0],p=t.insertEdge(t.getDefaultParent(),null,getEdgeCount()+1,g,h[0],"rounded=0;html=1;jettySize=auto;orthogonalLoop=1;strokeColor=#3E6F96;strokeWidth=2;");if(!edgeVerify(p))return;t.edgeArr[p.id]||(t.edgeArr[p.id]={source:g,target:u}),t.nodeData[g.id].childrenIds.push(u.id),t.nodeData[u.id].parentIds.push(g.id)}},r=document.createElement("div");switch(r.className="geItem",r.style.border="1px solid red",r.style.width="60px",r.style.height="60px",e.type){case"filter":case"sort":case"sample":case"layering":case"groupCount":case"delRepeat":case"comparison":case"change":case"union":case"sql":case"newNullNode":case"relation":mxUtils.makeDraggable($("#"+e.id)[0],graph,n,r,null,null,!0,!0);break;case"datasource":mxUtils.makeDraggable($("#"+e.tId+"_a")[0],graph,n,r,null,null,!0,!0)}},initNodeData=function(e,t){var i={settingId:(new UUIDGenerator).id},n=!1,r=!1,o={nodeId:e.id,nodeName:e.english?e.english:e.name,optType:e.type,isCreateTable:0,nodeExcuteStatus:1,nodeDescription:"",resultTableName:""};switch(e.type){case"datasource":n=!0,e.english?o.resultTableName=e.english:o.resultTableName=e.name,o.nodeExcuteStatus=3,delete i.settingId;break;case"newNullNode":o.resultTableStatus=1,o.midTableStatus=1;break;case"barChart":delete i.settingId;break;case"layering":o.resultTableNameArr=[],o.nodeSqlArr=[],o.selectSqlNotViewTableArr=[],i.index=0;break;case"comparison":o.dataTableName=""}graph.nodeData[e.id]={isSet:n,isChangeSource:r,setting:i,parentIds:[],childrenIds:[],columnsInfo:[],nodeInfo:o},t&&changeNodeIcon(o.nodeExcuteStatus,n,e.id),graph.scrollCellToVisible(graph.getModel().getCell(e.id)),graph.setSelectionCells(graph.getModel().getCell(e.id))},createCellShape=function(e,t){var i="";switch(e){case"newNullNode":i=IMAGE_PATH+"/table.png";break;case"datasource":i=t?IMAGE_PATH+"/table_copy.png":IMAGE_PATH+"/table.png";break;case"sql":case"filter":case"sort":case"sample":case"layering":case"groupCount":case"delRepeat":case"comparison":case"change":case"union":case"relation":case"barChart":i=IMAGE_PATH+"/"+e+".png"}return"shape=label;image="+i+";whiteSpace=wrap;indicatorColor=#FF0000;verticalLabelPosition=bottom;verticalAlign=top;imageVerticalAlign=top;imageAlign=center;strokeColor=transparent;imageWidth=50;imageHeight=50;spacingTop=-45"},getEdgeCount=function(){for(var e=graph.getDefaultParent(),t=e.children,i=0,n=0;n<t.length;n++)t[n].edge&&i++;return i},toolCellInitSql=function(e){if("undefined"!=typeof e&&e.edge){var t=!1;if(!edgeVerify(e))return;if(graph.edgeArr[e.id]){var i=graph.edgeArr[e.id].source,n=graph.edgeArr[e.id].target;if(graph.nodeData[i.id]&&i.id!==e.source.id||graph.nodeData[n.id]&&n.id!==e.target.id){if(graph.nodeData[i.id]){var r=graph.nodeData[i.id].childrenIds;if($.inArray(n.id,r)>-1){var o=$.inArray(n.id,r);graph.nodeData[i.id].childrenIds.splice(o,1)}}if(graph.nodeData[n.id]){var a=graph.nodeData[n.id].parentIds;if($.inArray(i.id,a)>-1){var o=$.inArray(i.id,a);graph.nodeData[n.id].parentIds.splice(o,1)}}$.inArray(e.source.id,graph.nodeData[e.target.id].parentIds)<0&&graph.nodeData[e.target.id].parentIds.push(e.source.id),$.inArray(e.target.id,graph.nodeData[e.source.id].childrenIds)<0&&graph.nodeData[e.source.id].childrenIds.push(e.target.id),changeNodeInfo(e.target.id,!0),changeNodeInfo(n.id,!0),t=!0}}else $.inArray(e.source.id,graph.nodeData[e.target.id].parentIds)<0&&graph.nodeData[e.target.id].parentIds.push(e.source.id),$.inArray(e.target.id,graph.nodeData[e.source.id].childrenIds)<0&&graph.nodeData[e.source.id].childrenIds.push(e.target.id),t=!0;if(t){var s="";null!=e.value||e.value?s="改变线":(graph.cellLabelChanged(e,""+getEdgeCount(),null),ownerEditor.editor.undoManager.indexOfNextAdd-=1,ownerEditor.editor.undoManager.history.pop(),s="生成线"),refrashHistoryZtree(s+"【"+e.value+"】"),autoSaveGraph(),graph.edgeArr[e.id]={source:e.source,target:e.target}}}};