function ChangePageSetup(t,e,i,n){this.ui=t,this.color=e,this.previousColor=e,this.image=i,this.previousImage=i,this.format=n,this.previousFormat=n,this.ignoreColor=!1,this.ignoreImage=!1}EditorUi=function(t,e,i){mxEventSource.call(this),this.destroyFunctions=[],this.editor=t||new Editor,this.container=e||document.getElementById("graphContainer");var n=this.editor.graph;n.useCssTransforms&&(this.lazyZoomDelay=0),this.editor.chromeless&&!this.editor.editable&&(n.isEnabled=function(){return!1},n.panningHandler.isForcePanningEvent=function(t){return!mxEvent.isPopupTrigger(t.getEvent())}),this.actions=new Actions(this),this.menus=this.createMenus(),this.createDivs(),this.createUi(),this.refresh();var r=mxUtils.bind(this,function(t){return null==t&&(t=window.event),this.isSelectionAllowed(t)||n.isEditing()});if(!this.editor.chromeless||this.editor.editable){var a=function(t){var e=mxEvent.getSource(t);if("A"==e.nodeName)for(;null!=e;){if("geHint"==e.className)return!0;e=e.parentNode}return r(t)};mxClient.IS_IE&&("undefined"==typeof document.documentMode||document.documentMode<9)?mxEvent.addListener(this.diagramContainer,"contextmenu",a):this.diagramContainer.oncontextmenu=a}else n.panningHandler.usePopupTrigger=!1;if(n.init(this.diagramContainer),mxClient.IS_SVG&&null!=n.view.getDrawPane()){var l=n.view.getDrawPane().ownerSVGElement;null!=l&&(l.style.position="absolute")}this.hoverIcons=this.createHoverIcons(),mxEvent.addListener(this.diagramContainer,"mousemove",mxUtils.bind(this,function(t){var e=mxUtils.getOffset(this.diagramContainer);mxEvent.getClientX(t)-e.x-this.diagramContainer.clientWidth>0||mxEvent.getClientY(t)-e.y-this.diagramContainer.clientHeight>0?this.diagramContainer.setAttribute("title",mxResources.get("panTooltip")):this.diagramContainer.removeAttribute("title")}));var o=!1,s=this.hoverIcons.isResetEvent;this.hoverIcons.isResetEvent=function(t,e){return o||s.apply(this,arguments)},this.keydownHandler=mxUtils.bind(this,function(t){32==t.which?(o=!0,this.hoverIcons.reset(),n.container.style.cursor="move",n.isEditing()||mxEvent.getSource(t)!=n.container||mxEvent.consume(t)):mxEvent.isConsumed(t)||27!=t.keyCode||this.hideDialog()}),mxEvent.addListener(document,"keydown",this.keydownHandler),this.keyupHandler=mxUtils.bind(this,function(t){n.container.style.cursor="",o=!1}),mxEvent.addListener(document,"keyup",this.keyupHandler);var h=n.panningHandler.isForcePanningEvent;n.panningHandler.isForcePanningEvent=function(t){return h.apply(this,arguments)||o||mxEvent.isMouseEvent(t.getEvent())&&(this.usePopupTrigger||!mxEvent.isPopupTrigger(t.getEvent()))&&(!mxEvent.isControlDown(t.getEvent())&&mxEvent.isRightMouseButton(t.getEvent())||mxEvent.isMiddleMouseButton(t.getEvent()))};var d=n.cellEditor.isStopEditingEvent;n.cellEditor.isStopEditingEvent=function(t){return d.apply(this,arguments)||13==t.keyCode&&(!mxClient.IS_SF&&mxEvent.isControlDown(t)||mxClient.IS_MAC&&mxEvent.isMetaDown(t)||mxClient.IS_SF&&mxEvent.isShiftDown(t))};var c=this,g=n.cellEditor.startEditing;n.cellEditor.startEditing=function(){if(g.apply(this,arguments),n.cellEditor.isContentEditing()){var t=!1,e=function(){t||(t=!0,window.setTimeout(function(){for(var e=n.getSelectedElement(),i=e;null!=i&&i.nodeType!=mxConstants.NODETYPE_ELEMENT;)i=i.parentNode;if(null!=i){var r=mxUtils.getCurrentStyle(i);if(null!=r&&null!=c.toolbar){var a=r.fontFamily;"'"==a.charAt(0)&&(a=a.substring(1)),"'"==a.charAt(a.length-1)&&(a=a.substring(0,a.length-1)),c.toolbar.setFontName(a),c.toolbar.setFontSize(parseInt(r.fontSize))}}t=!1},0))};mxEvent.addListener(n.cellEditor.textarea,"input",e),mxEvent.addListener(n.cellEditor.textarea,"touchend",e),mxEvent.addListener(n.cellEditor.textarea,"mouseup",e),mxEvent.addListener(n.cellEditor.textarea,"keyup",e),e()}};var p=n.cellEditor.stopEditing;if(n.cellEditor.stopEditing=function(t,e){p.apply(this,arguments)},n.container.setAttribute("tabindex","0"),n.container.style.cursor="default",window.self===window.top&&null!=n.container.parentNode)try{n.container.focus()}catch(u){}var m=n.fireMouseEvent;n.fireMouseEvent=function(t,e,i){if(t==mxEvent.MOUSE_DOWN){this.container.focus(),n.curCell=void 0==e.sourceState?null:e.sourceState.cell;try{n.curCell&&"undefined"!=typeof n.curCell.referedNodeId&&(n.curCell=n.model.cells[n.curCell.referedNodeId]),initNodeDetail()}catch(r){}}m.apply(this,arguments)},n.popupMenuHandler.autoExpand=!0,null!=this.menus&&(n.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(t,e,i){this.menus.createPopupMenu(t,e,i)})),mxEvent.addGestureListeners(document,mxUtils.bind(this,function(t){n.popupMenuHandler.hideMenu()})),this.keyHandler=this.createKeyHandler(t),this.getKeyHandler=function(){return keyHandler};for(var v=["rounded","shadow","glass","dashed","dashPattern","comic","labelBackgroundColor"],y=["shape","edgeStyle","curved","rounded","elbow","comic","jumpStyle","jumpSize"],x=["fontFamily","fontSize","fontColor"],A=["edgeStyle","startArrow","startFill","startSize","endArrow","endFill","endSize","jettySize","orthogonalLoop"],f=[["startArrow","startFill","startSize","sourcePerimeterSpacing","endArrow","endFill","endSize","targetPerimeterSpacing","jettySize","orthogonalLoop"],["strokeColor","strokeWidth"],["fillColor","gradientColor"],x,["opacity"],["align"],["html"]],E=0;E<f.length;E++)for(var C=0;C<f[E].length;C++)v.push(f[E][C]);for(var E=0;E<y.length;E++)mxUtils.indexOf(v,y[E])<0&&v.push(y[E]);var S=function(t,e){var i=n.getModel();i.beginUpdate();try{if(e)for(var r=i.isEdge(d),a=r?n.currentEdgeStyle:n.currentVertexStyle,l=["fontSize","fontFamily","fontColor"],o=0;o<l.length;o++){var s=a[l[o]];null!=s&&n.setCellStyles(l[o],s,t)}else for(var h=0;h<t.length;h++){for(var d=t[h],c=i.getStyle(d),g=null!=c?c.split(";"):[],p=v.slice(),o=0;o<g.length;o++){var u=g[o],m=u.indexOf("=");if(m>=0){var x=u.substring(0,m),A=mxUtils.indexOf(p,x);A>=0&&p.splice(A,1);for(var E=0;E<f.length;E++){var C=f[E];if(mxUtils.indexOf(C,x)>=0)for(var S=0;S<C.length;S++){var b=mxUtils.indexOf(p,C[S]);b>=0&&p.splice(b,1)}}}}for(var r=i.isEdge(d),a=r?n.currentEdgeStyle:n.currentVertexStyle,w=i.getStyle(d),o=0;o<p.length;o++){var x=p[o],M=a[x];null==M||"shape"==x&&!r||(!r||mxUtils.indexOf(y,x)<0)&&(w=mxUtils.setStyle(w,x,M))}i.setStyle(d,w)}}finally{i.endUpdate()}};if(n.addListener("cellsInserted",function(t,e){S(e.getProperty("cells"))}),n.addListener("textInserted",function(t,e){S(e.getProperty("cells"),!0)}),n.connectionHandler.addListener(mxEvent.CONNECT,function(t,e){var i=[e.getProperty("cell")];e.getProperty("terminalInserted")&&i.push(e.getProperty("terminal")),S(i)}),this.addListener("styleChanged",mxUtils.bind(this,function(t,e){var i=e.getProperty("cells"),r=!1,a=!1;if(i.length>0)for(var l=0;l<i.length&&(r=n.getModel().isVertex(i[l])||r,a=n.getModel().isEdge(i[l])||a,!a||!r);l++);else r=!0,a=!0;for(var o=e.getProperty("keys"),s=e.getProperty("values"),l=0;l<o.length;l++){var h=mxUtils.indexOf(x,o[l])>=0;("strokeColor"!=o[l]||null!=s[l]&&"none"!=s[l])&&(mxUtils.indexOf(y,o[l])>=0?a||mxUtils.indexOf(A,o[l])>=0?null==s[l]?delete n.currentEdgeStyle[o[l]]:n.currentEdgeStyle[o[l]]=s[l]:r&&mxUtils.indexOf(v,o[l])>=0&&(null==s[l]?delete n.currentVertexStyle[o[l]]:n.currentVertexStyle[o[l]]=s[l]):mxUtils.indexOf(v,o[l])>=0&&((r||h)&&(null==s[l]?delete n.currentVertexStyle[o[l]]:n.currentVertexStyle[o[l]]=s[l]),(a||h||mxUtils.indexOf(A,o[l])>=0)&&(null==s[l]?delete n.currentEdgeStyle[o[l]]:n.currentEdgeStyle[o[l]]=s[l])))}if(null!=this.toolbar){if(this.toolbar.setFontName(n.currentVertexStyle.fontFamily||Menus.prototype.defaultFont),this.toolbar.setFontSize(n.currentVertexStyle.fontSize||Menus.prototype.defaultFontSize),null!=this.toolbar.edgeStyleMenu){var d=this.toolbar.edgeStyleMenu.getElementsByTagName("div")[0];"orthogonalEdgeStyle"==n.currentEdgeStyle.edgeStyle&&"1"==n.currentEdgeStyle.curved?d.className="geSprite geSprite-curved":"straight"==n.currentEdgeStyle.edgeStyle||"none"==n.currentEdgeStyle.edgeStyle||null==n.currentEdgeStyle.edgeStyle?d.className="geSprite geSprite-straight":"entityRelationEdgeStyle"==n.currentEdgeStyle.edgeStyle?d.className="geSprite geSprite-entity":"elbowEdgeStyle"==n.currentEdgeStyle.edgeStyle?d.className="geSprite geSprite-"+("vertical"==n.currentEdgeStyle.elbow?"verticalelbow":"horizontalelbow"):"isometricEdgeStyle"==n.currentEdgeStyle.edgeStyle?d.className="geSprite geSprite-"+("vertical"==n.currentEdgeStyle.elbow?"verticalisometric":"horizontalisometric"):d.className="geSprite geSprite-orthogonal"}if(null!=this.toolbar.edgeShapeMenu){var c=this.toolbar.edgeShapeMenu.getElementsByTagName("div")[0];"link"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-linkedge":"flexArrow"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-arrow":"arrow"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-simplearrow":c.className="geSprite geSprite-connection"}if(null!=this.toolbar.lineStartMenu){var g=this.toolbar.lineStartMenu.getElementsByTagName("div")[0];g.className=this.getCssClassForMarker("start",n.currentEdgeStyle.shape,n.currentEdgeStyle[mxConstants.STYLE_STARTARROW],mxUtils.getValue(n.currentEdgeStyle,"startFill","1"))}if(null!=this.toolbar.lineEndMenu){var p=this.toolbar.lineEndMenu.getElementsByTagName("div")[0];p.className=this.getCssClassForMarker("end",n.currentEdgeStyle.shape,n.currentEdgeStyle[mxConstants.STYLE_ENDARROW],mxUtils.getValue(n.currentEdgeStyle,"endFill","1"))}}})),null!=this.toolbar){var b=mxUtils.bind(this,function(){var t=n.currentVertexStyle.fontFamily||"Helvetica",e=String(n.currentVertexStyle.fontSize||"12"),i=n.getView().getState(n.getSelectionCell());null!=i&&(t=i.style[mxConstants.STYLE_FONTFAMILY]||t,e=i.style[mxConstants.STYLE_FONTSIZE]||e,t.length>10&&(t=t.substring(0,8)+"...")),this.toolbar.setFontName(t),this.toolbar.setFontSize(e)});n.getSelectionModel().addListener(mxEvent.CHANGE,b),n.getModel().addListener(mxEvent.CHANGE,b)}return n.addListener(mxEvent.CELLS_ADDED,function(t,e){var i=e.getProperty("cells"),r=e.getProperty("parent");n.getModel().isLayer(r)&&!n.isCellVisible(r)&&null!=i&&i.length>0&&n.getModel().setVisible(r,!0)}),this.gestureHandler=mxUtils.bind(this,function(t){null!=this.currentMenu&&mxEvent.getSource(t)!=this.currentMenu.div&&this.hideCurrentMenu()}),mxEvent.addGestureListeners(document,this.gestureHandler),this.resizeHandler=mxUtils.bind(this,function(){window.setTimeout(mxUtils.bind(this,function(){null!=this.editor.graph&&this.refresh()}),0)}),mxEvent.addListener(window,"resize",this.resizeHandler),this.orientationChangeHandler=mxUtils.bind(this,function(){this.refresh()}),mxEvent.addListener(window,"orientationchange",this.orientationChangeHandler),mxClient.IS_IOS&&!window.navigator.standalone&&(this.scrollHandler=mxUtils.bind(this,function(){window.scrollTo(0,0)}),mxEvent.addListener(window,"scroll",this.scrollHandler)),this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.resetScrollbars()})),this.addListener("gridEnabledChanged",mxUtils.bind(this,function(){n.view.validateBackground()})),this.addListener("backgroundColorChanged",mxUtils.bind(this,function(){n.view.validateBackground()})),n.addListener("gridSizeChanged",mxUtils.bind(this,function(){n.isGridEnabled()&&n.view.validateBackground()})),this.editor.resetGraph(),this.init(),this.open(),n.preExeGetFields=function(t,e){var i=!1;return $.ajax({type:"post",url:"/data/tableMeta/createViewAndGetCols",dataType:"json",async:!1,data:{tableMetaUuid:e.id,isEnclose:"1"},beforeSend:function(t){},success:function(e){var r=3;if(null==e.data)i=!0,alert("获取数据表【"+t.value+"】信息失败,无法创建数据表节点"),r=4;else{for(var a=[],l="SELECT",o=0;o<e.data.length;o++){var s=null===e.data[o].chnName||""===e.data[o].chnName?e.data[o].colName:e.data[o].chnName,h=s;a.push({columnName:s,columnType:e.data[o].dataType,columnLength:e.data[o].dataLength,isOutputColumn:1,newColumnName:h}),l+=o===e.data.length-1?h:" "+h+","}l+=" FROM "+e.data[0].viewName,n.nodeData[t.id].nodeInfo.resultTableName=e.data[0].viewName,n.nodeData[t.id].nodeInfo.nodeSql=l,n.nodeData[t.id].columnsInfo=a}n.nodeData[t.id].nodeInfo.nodeExcuteStatus=r}}),i},this},mxUtils.extend(EditorUi,mxEventSource),EditorUi.compactUi=!0,EditorUi.prototype.splitSize=(mxClient.IS_TOUCH||mxClient.IS_POINTER,6),EditorUi.prototype.sidebarWidth=240,EditorUi.prototype.resultHeight=335,EditorUi.prototype.resultContentHeight=225,EditorUi.prototype.scrollBarHeight=0,EditorUi.prototype.detailContainerWidth=300,EditorUi.prototype.leftMenuWidth=0,EditorUi.prototype.formatWidth=240,EditorUi.prototype.toolbarHeight=120,EditorUi.prototype.allowAnimation=!0,EditorUi.prototype.init=function(){var t=this.editor.graph;mxEvent.addListener(t.container,"keydown",mxUtils.bind(this,function(t){this.onKeyDown(t)})),mxEvent.addListener(t.container,"keypress",mxUtils.bind(this,function(t){this.onKeyPress(t)})),this.addUndoListener(),this.addBeforeUnloadListener(),t.getSelectionModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()})),t.getModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()}));var e=t.setDefaultParent,i=this;this.editor.graph.setDefaultParent=function(){e.apply(this,arguments),i.updateActionStates()},this.updateActionStates(),this.initClipboard(),this.initCanvas(),null!=this.format&&this.format.init()},EditorUi.prototype.onKeyDown=function(t){var e=this.editor.graph;9==t.which&&e.isEnabled()&&!mxEvent.isAltDown(t)&&(e.isEditing()?e.stopEditing(!1):e.selectCell(!mxEvent.isShiftDown(t)),mxEvent.consume(t))},EditorUi.prototype.onKeyPress=function(t){var e=this.editor.graph;if(this.isImmediateEditingEvent(t)&&!e.isEditing()&&!e.isSelectionEmpty()&&0!==t.which&&!mxEvent.isAltDown(t)&&!mxEvent.isControlDown(t)&&!mxEvent.isMetaDown(t)&&(e.escape(),e.startEditing(),mxClient.IS_FF)){var i=e.cellEditor;i.textarea.innerHTML=String.fromCharCode(t.which);var n=document.createRange();n.selectNodeContents(i.textarea),n.collapse(!1);var r=window.getSelection();r.removeAllRanges(),r.addRange(n)}},EditorUi.prototype.isImmediateEditingEvent=function(t){return!0},EditorUi.prototype.getCssClassForMarker=function(t,e,i,n){var r="";return r="flexArrow"==e?null!=i&&i!=mxConstants.NONE?"geSprite geSprite-"+t+"blocktrans":"geSprite geSprite-noarrow":i==mxConstants.ARROW_CLASSIC?"1"==n?"geSprite geSprite-"+t+"classic":"geSprite geSprite-"+t+"classictrans":i==mxConstants.ARROW_CLASSIC_THIN?"1"==n?"geSprite geSprite-"+t+"classicthin":"geSprite geSprite-"+t+"classicthintrans":i==mxConstants.ARROW_OPEN?"geSprite geSprite-"+t+"open":i==mxConstants.ARROW_OPEN_THIN?"geSprite geSprite-"+t+"openthin":i==mxConstants.ARROW_BLOCK?"1"==n?"geSprite geSprite-"+t+"block":"geSprite geSprite-"+t+"blocktrans":i==mxConstants.ARROW_BLOCK_THIN?"1"==n?"geSprite geSprite-"+t+"blockthin":"geSprite geSprite-"+t+"blockthintrans":i==mxConstants.ARROW_OVAL?"1"==n?"geSprite geSprite-"+t+"oval":"geSprite geSprite-"+t+"ovaltrans":i==mxConstants.ARROW_DIAMOND?"1"==n?"geSprite geSprite-"+t+"diamond":"geSprite geSprite-"+t+"diamondtrans":i==mxConstants.ARROW_DIAMOND_THIN?"1"==n?"geSprite geSprite-"+t+"thindiamond":"geSprite geSprite-"+t+"thindiamondtrans":"openAsync"==i?"geSprite geSprite-"+t+"openasync":"dash"==i?"geSprite geSprite-"+t+"dash":"cross"==i?"geSprite geSprite-"+t+"cross":"async"==i?"1"==n?"geSprite geSprite-"+t+"async":"geSprite geSprite-"+t+"asynctrans":"circle"==i||"circlePlus"==i?"1"==n||"circle"==i?"geSprite geSprite-"+t+"circle":"geSprite geSprite-"+t+"circleplus":"ERone"==i?"geSprite geSprite-"+t+"erone":"ERmandOne"==i?"geSprite geSprite-"+t+"eronetoone":"ERmany"==i?"geSprite geSprite-"+t+"ermany":"ERoneToMany"==i?"geSprite geSprite-"+t+"eronetomany":"ERzeroToOne"==i?"geSprite geSprite-"+t+"eroneopt":"ERzeroToMany"==i?"geSprite geSprite-"+t+"ermanyopt":"geSprite geSprite-noarrow"},EditorUi.prototype.createMenus=function(){return null},EditorUi.prototype.updatePasteActionStates=function(){var t=this.editor.graph,e=this.actions.get("paste");e.setEnabled(this.editor.graph.cellEditor.isContentEditing()||!mxClipboard.isEmpty()&&t.isEnabled()&&!t.isCellLocked(t.getDefaultParent()))},EditorUi.prototype.initClipboard=function(){var t=this,e=mxClipboard.cut;mxClipboard.cut=function(i){i.cellEditor.isContentEditing()?document.execCommand("cut",!1,null):e.apply(this,arguments),t.updatePasteActionStates()};var i=mxClipboard.copy;mxClipboard.copy=function(e){e.cellEditor.isContentEditing()?document.execCommand("copy",!1,null):i.apply(this,arguments),t.updatePasteActionStates()};var n=mxClipboard.paste;mxClipboard.paste=function(e){var i=null;return e.cellEditor.isContentEditing()?document.execCommand("paste",!1,null):i=n.apply(this,arguments),t.updatePasteActionStates(),i};var r=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){r.apply(this,arguments),t.updatePasteActionStates()};var a=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(e,i){a.apply(this,arguments),t.updatePasteActionStates()},this.updatePasteActionStates()},EditorUi.prototype.lazyZoomDelay=20,EditorUi.prototype.initCanvas=function(){var t=this.editor.graph;t.timerAutoScroll=!0,t.getPagePadding=function(){return new mxPoint(Math.max(0,Math.round(0)),Math.max(0,Math.round(0)))},t.view.getBackgroundPageBounds=function(){var t=this.graph.getPageLayout(),e=this.graph.getPageSize();return new mxRectangle(this.scale*(this.translate.x+t.x*e.width),this.scale*(this.translate.y+t.y*e.height),this.scale*t.width*e.width,this.scale*t.height*e.height)},t.getPreferredPageSize=function(t,e,i){var n=this.getPageLayout(),r=this.getPageSize();return new mxRectangle(0,0,n.width*r.width,n.height*r.height)};var e=null,i=this;if(this.editor.extendCanvas){var n=t.view.validate;t.view.validate=function(){if(null!=this.graph.container&&mxUtils.hasScrollbars(this.graph.container)){var t=this.graph.getPagePadding(),e=this.graph.getPageSize();this.translate.x,this.translate.y;this.translate.x=t.x-(this.x0||0)*e.width,this.translate.y=t.y-(this.y0||0)*e.height}n.apply(this,arguments)};var r=t.sizeDidChange;t.sizeDidChange=function(){if(null!=this.container&&mxUtils.hasScrollbars(this.container)){var e=this.getPageLayout(),i=this.getPagePadding(),n=this.getPageSize(),a=Math.ceil(2*i.x+e.width*n.width),l=Math.ceil(2*i.y+e.height*n.height),o=t.minimumGraphSize;(null==o||o.width!=a||o.height!=l)&&(t.minimumGraphSize=new mxRectangle(0,0,a,l));var s=i.x-e.x*n.width,h=i.y-e.y*n.height;if(!this.autoTranslate&&(this.view.translate.x!=s||this.view.translate.y!=h)){this.autoTranslate=!0,this.view.x0=e.x,this.view.y0=e.y;var d=t.view.translate.x,c=t.view.translate.y;return t.view.setTranslate(s,h),t.container.scrollLeft+=Math.round((s-d)*t.view.scale),t.container.scrollTop+=Math.round((h-c)*t.view.scale),void(this.autoTranslate=!1)}r.apply(this,arguments)}}}t.updateZoomTimeout=null,t.cumulativeZoomFactor=1;var a=null;t.lazyZoom=function(n){null!=this.updateZoomTimeout&&window.clearTimeout(this.updateZoomTimeout),n?this.view.scale*this.cumulativeZoomFactor<.15?this.cumulativeZoomFactor=(this.view.scale+.01)/this.view.scale:(this.cumulativeZoomFactor*=this.zoomFactor,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale):this.view.scale*this.cumulativeZoomFactor<=.15?this.cumulativeZoomFactor=(this.view.scale-.01)/this.view.scale:(this.cumulativeZoomFactor/=this.zoomFactor,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale),this.cumulativeZoomFactor=Math.max(.01,Math.min(this.view.scale*this.cumulativeZoomFactor,160)/this.view.scale),this.updateZoomTimeout=window.setTimeout(mxUtils.bind(this,function(){var n=mxUtils.getOffset(t.container),r=0,l=0;null!=a&&(r=t.container.offsetWidth/2-a.x+n.x,l=t.container.offsetHeight/2-a.y+n.y);var o=this.view.scale;this.zoom(this.cumulativeZoomFactor);var s=this.view.scale;s!=o&&(null!=e&&i.chromelessResize(!1,null,r*(this.cumulativeZoomFactor-1),l*(this.cumulativeZoomFactor-1)),!mxUtils.hasScrollbars(t.container)||0==r&&0==l||(t.container.scrollLeft-=r*(this.cumulativeZoomFactor-1),t.container.scrollTop-=l*(this.cumulativeZoomFactor-1))),this.cumulativeZoomFactor=1,this.updateZoomTimeout=null}),this.lazyZoomDelay)},mxEvent.addMouseWheelListener(mxUtils.bind(this,function(e,i){if((null==this.dialogs||0==this.dialogs.length)&&t.isZoomWheelEvent(e))for(var n=mxEvent.getSource(e);null!=n;){if(n==t.container)return a=new mxPoint(mxEvent.getClientX(e),mxEvent.getClientY(e)),t.lazyZoom(i),void mxEvent.consume(e);n=n.parentNode}}))},EditorUi.prototype.isSelectionAllowed=function(t){return"SELECT"==mxEvent.getSource(t).nodeName||"INPUT"==mxEvent.getSource(t).nodeName&&mxUtils.isAncestorNode(null,mxEvent.getSource(t))},EditorUi.prototype.addBeforeUnloadListener=function(){window.onbeforeunload=mxUtils.bind(this,function(){return this.onBeforeUnload()})},EditorUi.prototype.onBeforeUnload=function(){},EditorUi.prototype.open=function(){this.editor.graph.view.validate(),this.editor.graph.sizeDidChange(),this.editor.fireEvent(new mxEventObject("resetGraphView"))},EditorUi.prototype.setCurrentMenu=function(t,e){this.currentMenuElt=e,this.currentMenu=t},EditorUi.prototype.resetCurrentMenu=function(){this.currentMenuElt=null,this.currentMenu=null},EditorUi.prototype.hideCurrentMenu=function(){null!=this.currentMenu&&(this.currentMenu.hideMenu(),this.resetCurrentMenu())},EditorUi.prototype.createHoverIcons=function(){return new HoverIcons(this.editor.graph)},EditorUi.prototype.redo=function(){try{var t=this.editor.graph;t.isEditing()?document.execCommand("redo",!1,null):this.editor.undoManager.redo()}catch(e){}},EditorUi.prototype.undo=function(){try{var t=this.editor.graph;if(t.isEditing()){var e=t.cellEditor.textarea.innerHTML;document.execCommand("undo",!1,null),e==t.cellEditor.textarea.innerHTML&&(t.stopEditing(!0),this.editor.undoManager.undo())}else this.editor.undoManager.undo()}catch(i){}},EditorUi.prototype.canRedo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canRedo()},EditorUi.prototype.canUndo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canUndo()},EditorUi.prototype.getEditBlankXml=function(){return mxUtils.getXml(this.editor.getGraphXml())},EditorUi.prototype.getUrl=function(t){var e=null!=t?t:window.location.pathname,i=e.indexOf("?")>0?1:0;for(var n in urlParams)e+=0==i?"?":"&",e+=n+"="+urlParams[n],i++;return e},EditorUi.prototype.setScrollbars=function(t){var e=this.editor.graph,i=e.container.style.overflow;if(e.scrollbars=t,this.editor.updateGraphComponents(),i!=e.container.style.overflow)if("hidden"==e.container.style.overflow){var n=e.view.translate;e.view.setTranslate(n.x-e.container.scrollLeft/e.view.scale,n.y-e.container.scrollTop/e.view.scale),e.container.scrollLeft=0,e.container.scrollTop=0,e.minimumGraphSize=null,e.sizeDidChange()}else{var r=e.view.translate.x,a=e.view.translate.y;e.view.translate.x=0,e.view.translate.y=0,e.sizeDidChange(),e.container.scrollLeft-=Math.round(r*e.view.scale),e.container.scrollTop-=Math.round(a*e.view.scale)}this.fireEvent(new mxEventObject("scrollbarsChanged"))},EditorUi.prototype.hasScrollbars=function(){return this.editor.graph.scrollbars},EditorUi.prototype.resetScrollbars=function(){var t=this.editor.graph;if(this.editor.extendCanvas)if(mxUtils.hasScrollbars(t.container))if(t.pageVisible){var e=t.getPagePadding();t.container.scrollTop=Math.floor(e.y-this.editor.initialTopSpacing)-1,t.container.scrollLeft=Math.floor(Math.min(e.x,(t.container.scrollWidth-t.container.clientWidth)/2))-1;var i=t.getGraphBounds();i.width>0&&i.height>0&&(i.x>t.container.scrollLeft+.9*t.container.clientWidth&&(t.container.scrollLeft=Math.min(i.x+i.width-t.container.clientWidth,i.x-10)),i.y>t.container.scrollTop+.9*t.container.clientHeight&&(t.container.scrollTop=Math.min(i.y+i.height-t.container.clientHeight,i.y-10)))}else{var i=t.getGraphBounds(),n=Math.max(i.width,t.scrollTileSize.width*t.view.scale),r=Math.max(i.height,t.scrollTileSize.height*t.view.scale);t.container.scrollTop=Math.floor(Math.max(0,i.y-Math.max(20,(t.container.clientHeight-r)/4))),t.container.scrollLeft=Math.floor(Math.max(0,i.x-Math.max(0,(t.container.clientWidth-n)/2)))}else if(t.pageVisible){var a=t.view.getBackgroundPageBounds();t.view.setTranslate(Math.floor(Math.max(0,(t.container.clientWidth-a.width)/2)-a.x),Math.floor(Math.max(0,(t.container.clientHeight-a.height)/2)-a.y))}else{var i=t.getGraphBounds();t.view.setTranslate(Math.floor(Math.max(0,Math.max(0,(t.container.clientWidth-i.width)/2)-i.x)),Math.floor(Math.max(0,Math.max(20,(t.container.clientHeight-i.height)/4))-i.y))}},EditorUi.prototype.setPageVisible=function(t){var e=this.editor.graph,i=mxUtils.hasScrollbars(e.container),n=0,r=0;if(i&&(n=e.view.translate.x*e.view.scale-e.container.scrollLeft,r=e.view.translate.y*e.view.scale-e.container.scrollTop),e.pageVisible=t,e.pageBreaksVisible=t,e.preferPageSize=t,e.view.validateBackground(),i){var a=e.getSelectionCells();e.clearSelection(),e.setSelectionCells(a)}e.sizeDidChange(),i&&(e.container.scrollLeft=e.view.translate.x*e.view.scale-n,e.container.scrollTop=e.view.translate.y*e.view.scale-r),this.fireEvent(new mxEventObject("pageViewChanged"))},ChangePageSetup.prototype.execute=function(){var t,e=this.ui.editor.graph;this.ignoreColor||(this.color=this.previousColor,t=e.background,this.ui.setBackgroundColor(this.previousColor),this.previousColor=t),this.ignoreImage||(this.image=this.previousImage,t=e.backgroundImage,this.ui.setBackgroundImage(this.previousImage),this.previousImage=t),null!=this.previousFormat&&(this.format=this.previousFormat,t=e.pageFormat,(this.previousFormat.width!=t.width||this.previousFormat.height!=t.height)&&(this.ui.setPageFormat(this.previousFormat),this.previousFormat=t)),null!=this.foldingEnabled&&this.foldingEnabled!=this.ui.editor.graph.foldingEnabled&&(this.ui.setFoldingEnabled(this.foldingEnabled),this.foldingEnabled=!this.foldingEnabled)},function(){var t=new mxObjectCodec(new ChangePageSetup,["ui","previousColor","previousImage","previousFormat"]);t.afterDecode=function(t,e,i){return i.previousColor=i.color,i.previousImage=i.image,i.previousFormat=i.format,null!=i.foldingEnabled&&(i.foldingEnabled=!i.foldingEnabled),i},mxCodecRegistry.register(t)}(),EditorUi.prototype.setBackgroundColor=function(t){this.editor.graph.background=t,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("backgroundColorChanged"))},EditorUi.prototype.setFoldingEnabled=function(t){this.editor.graph.foldingEnabled=t,this.editor.graph.view.revalidate(),this.fireEvent(new mxEventObject("foldingEnabledChanged"))},EditorUi.prototype.setPageFormat=function(t){this.editor.graph.pageFormat=t,this.editor.graph.pageVisible?(this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange()):this.actions.get("pageView").funct(),this.fireEvent(new mxEventObject("pageFormatChanged"))},EditorUi.prototype.setPageScale=function(t){this.editor.graph.pageScale=t,this.editor.graph.pageVisible?(this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange()):this.actions.get("pageView").funct(),this.fireEvent(new mxEventObject("pageScaleChanged"))},EditorUi.prototype.setGridColor=function(t){this.editor.graph.view.gridColor=t,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("gridColorChanged"))},EditorUi.prototype.addUndoListener=function(){var t=this.actions.get("undo"),e=this.actions.get("redo"),i=this.editor.undoManager,n=mxUtils.bind(this,function(){t.setEnabled(this.canUndo()),e.setEnabled(this.canRedo())});i.addListener(mxEvent.ADD,n),i.addListener(mxEvent.UNDO,n),i.addListener(mxEvent.REDO,n),i.addListener(mxEvent.CLEAR,n);var r=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){r.apply(this,arguments),n()};var a=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(t,e){a.apply(this,arguments),n()},n()},EditorUi.prototype.updateActionStates=function(){var t=this.editor.graph,e=!t.isSelectionEmpty(),i=!1,n=!1,r=t.getSelectionCells();if(null!=r)for(var a=0;a<r.length;a++){var l=r[a];if(t.getModel().isEdge(l)&&(n=!0),t.getModel().isVertex(l)&&(i=!0),n&&i)break}for(var o=["cut","copy","delete"],a=0;a<o.length;a++)this.actions.get(o[a]).setEnabled(e);this.actions.get("turn").setEnabled(!t.isSelectionEmpty()),this.actions.get("curved").setEnabled(n);var s=i&&1==t.getSelectionCount();this.actions.get("group").setEnabled(t.getSelectionCount()>1||s&&!t.isContainer(t.getSelectionCell())),this.actions.get("ungroup").setEnabled(1==t.getSelectionCount()&&(t.getModel().getChildCount(t.getSelectionCell())>0||s&&t.isContainer(t.getSelectionCell()))),this.actions.get("removeFromGroup").setEnabled(s&&t.getModel().isVertex(t.getModel().getParent(t.getSelectionCell())));t.view.getState(t.getSelectionCell()),1==t.getSelectionCount()&&t.isCellFoldable(t.getSelectionCell());this.actions.get("guides").setEnabled(t.isEnabled()),this.actions.get("grid").setEnabled(!this.editor.chromeless||this.editor.editable);var h=t.isEnabled()&&!t.isCellLocked(t.getDefaultParent());this.actions.get("selectVertices").setEnabled(h),this.actions.get("selectEdges").setEnabled(h),this.actions.get("selectAll").setEnabled(h),this.actions.get("selectNone").setEnabled(h),this.updatePasteActionStates()},EditorUi.prototype.refresh=function(t){var e=(this.container.clientWidth,this.container.clientHeight);mxClient.IS_IOS&&!window.navigator.standalone&&window.innerHeight!==document.documentElement.clientHeight&&window.scrollTo(0,0);var i=this.graphToolDiv.clientWidth;this.hsplitPosition="undefined"!=typeof this.hsplitPosition?this.hsplitPosition:this.sidebarWidth;var n=Math.max(0,Math.min(this.hsplitPosition,i-this.splitSize-20));this.sidebarContainer&&(this.sidebarContainer.style.width=n+"px"),this.sidebarContainer.style.height=e+"px",this.container.style.width=$(this.graphToolDiv).width()-this.hsplitPosition-this.detailContainerWidth-this.splitSize+"px",this.vsplit.style.left=$(this.sidebarContainer).width()+this.splitSize+5+"px",this.vsplit.style.width=$(this.graphToolDiv).width()-this.hsplitPosition-this.detailContainerWidth-this.splitSize+"px",this.detailContainer.style.height=this.sidebarContainer.style.height,this.detailContainer.style.bottom=this.sidebarContainer.style.height,this.container.style.left=n+this.splitSize+"px",this.hsplit.style.left=n+"px"},EditorUi.prototype.refreshv=function(t){var e=document.documentElement.clientHeight,i=Math.max(1,Math.min(this.vsplitPosition,e-200)),n=this.container.clientHeight-this.toolbarContainer.clientHeight;i=n>i?i:n,this.resultContainer.style.height=i-45+"px",this.diagramContainer.style.bottom=i+this.splitSize-45+"px",this.vsplit.style.bottom=i+"px",this.tableArea.style.height=i-110+"px",this.sysInfoArea.style.height=i-110+"px",this.outLineArea.style.height=i-110+"px"},EditorUi.prototype.createDivs=function(){this.graphToolDiv=document.getElementById("graphToolDiv"),this.sidebarContainer=document.getElementById("accordion"),this.toolbarContainer=document.getElementById("geToolbarContainer"),this.diagramContainer=document.getElementById("geDiagramContainer"),this.backgroundPage=document.getElementById("geBackgroundPage"),this.detailContainer=document.getElementById("detailContainer"),this.resultContainer=document.getElementById("geResultContainer"),this.tableArea=document.getElementById("tableArea"),this.sysInfoArea=document.getElementById("sysInfoArea"),this.outLineArea=document.getElementById("outLineArea"),this.hsplit=document.getElementById("geHsplit"),this.vsplit=document.getElementById("geVsplit"),this.leftMenuWidth=$(this.graphToolDiv).offset().left;var t=$(this.graphToolDiv).height()-this.toolbarHeight+10;this.sidebarContainer.style.width=this.sidebarWidth+"px",this.resultContainer.style.height=this.resultHeight-45+"px",this.container.style.left=this.sidebarWidth+this.splitSize+"px",this.container.style.right=this.detailContainerWidth+15+"px",
this.container.style.width=$(this.graphToolDiv).width()-this.sidebarWidth-this.splitSize-this.detailContainerWidth+"px",this.container.style.height=t+"px",this.diagramContainer.style.bottom=this.resultHeight-45+"px",this.detailContainer.style.width=this.detailContainerWidth+"px",this.hsplit.style.width=this.splitSize+"px",this.hsplit.style.bottom=t+"px",this.hsplit.style.height=t+"px",this.hsplit.style.left=this.sidebarWidth+"px",this.vsplit.style.width=$(this.graphToolDiv).width()-this.sidebarWidth-this.splitSize-this.detailContainerWidth+"px",this.vsplit.style.height=this.splitSize+"px",this.vsplit.style.bottom=this.resultHeight+"px",this.vsplit.style.left=this.sidebarWidth+$(this.graphToolDiv).offset().left+this.splitSize+"px",this.tableArea.style.height=this.resultContentHeight+"px",this.sysInfoArea.style.height=this.resultContentHeight+"px",this.outLineArea.style.height=this.resultContentHeight+"px"},EditorUi.prototype.createUi=function(){var t=document.body.clientWidth;this.container.appendChild(this.diagramContainer),null!=this.container&&null!=this.tabContainer&&this.container.appendChild(this.tabContainer),null!=this.toolbar&&(this.toolbarContainer.appendChild(this.toolbar.container),this.container.appendChild(this.toolbarContainer)),null!=this.hsplit&&this.addSplitHandler(this.hsplit,!0,0,mxUtils.bind(this,function(e){var i=t-this.sidebarWidth-this.splitSize-500;i>e&&e>this.sidebarWidth&&(this.hsplitPosition=e),this.refresh()})),null!=this.vsplit&&this.addSplitHandler(this.vsplit,!1,0,mxUtils.bind(this,function(t){t>150&&(this.vsplitPosition=t),this.refreshv()}))},EditorUi.prototype.createDiv=function(t){var e=document.createElement("div");return e.className=t,e},EditorUi.prototype.addSplitHandler=function(t,e,i,n){function r(t){if(null!=l){var r=new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t));n(Math.max(0,o+(e?r.x-l.x:l.y-r.y)-i)),mxEvent.consume(t),o!==d()&&(s=!0,h=null)}}function a(t){r(t),o=null,l=null}var l=null,o=null,s=!0,h=null;mxClient.IS_POINTER&&(t.style.touchAction="none");var d=mxUtils.bind(this,function(){return parseInt(e?t.style.left:t.style.bottom)});mxEvent.addGestureListeners(t,function(t){l=new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t)),o=d(),s=!1,mxEvent.consume(t)}),mxEvent.addGestureListeners(document,null,r,a),this.destroyFunctions.push(function(){mxEvent.removeGestureListeners(document,null,r,a)})},EditorUi.prototype.showDialog=function(t,e,i,n,r,a,l,o){this.editor.graph.tooltipHandler.hideTooltip(),null==this.dialogs&&(this.dialogs=[]),this.dialog=new Dialog(this,t,e,i,n,r,a,l,o),this.dialogs.push(this.dialog)},EditorUi.prototype.hideDialog=function(t){if(null!=this.dialogs&&this.dialogs.length>0){var e=this.dialogs.pop();e.close(t),this.dialog=this.dialogs.length>0?this.dialogs[this.dialogs.length-1]:null,null==this.dialog&&"hidden"!=this.editor.graph.container.style.visibility&&this.editor.graph.container.focus(),mxUtils.clearSelection(),this.editor.fireEvent(new mxEventObject("hideDialog"))}},EditorUi.prototype.pickColor=function(t,e){var i=this.editor.graph,n=i.cellEditor.saveSelection(),r=226+17*(Math.ceil(ColorDialog.prototype.presetColors.length/12)+Math.ceil(ColorDialog.prototype.defaultColors.length/12)),a=new ColorDialog(this,t||"none",function(t){i.cellEditor.restoreSelection(n),e(t)},function(){i.cellEditor.restoreSelection(n)});this.showDialog(a.container,230,r,!0,!1),a.init()},EditorUi.prototype.executeLayout=function(t,e,i){var n=this.editor.graph;if(n.isEnabled()){n.getModel().beginUpdate();try{t()}catch(r){throw r}finally{if(this.allowAnimation&&e&&navigator.userAgent.indexOf("Camino")<0){var a=new mxMorphing(n);a.addListener(mxEvent.DONE,mxUtils.bind(this,function(){n.getModel().endUpdate(),null!=i&&i()})),a.startAnimation()}else n.getModel().endUpdate(),null!=i&&i()}}},EditorUi.prototype.showImageDialog=function(t,e,i,n){var r=this.editor.graph.cellEditor,a=r.saveSelection(),l=mxUtils.prompt(t,e);if(r.restoreSelection(a),null!=l&&l.length>0){var o=new Image;o.onload=function(){i(l,o.width,o.height)},o.onerror=function(){i(null),mxUtils.alert(mxResources.get("fileNotFound"))},o.src=l}else i(null)},EditorUi.prototype.showLinkDialog=function(t,e,i){var n=new LinkDialog(this,t,e,i);this.showDialog(n.container,420,90,!0,!0),n.init()},EditorUi.prototype.showDataDialog=function(t){if(null!=t){var e=new EditDataDialog(this,t);this.showDialog(e.container,340,340,!0,!1,null,!1),e.init()}},EditorUi.prototype.showBackgroundImageDialog=function(t){t=null!=t?t:mxUtils.bind(this,function(t){var e=new ChangePageSetup(this,null,t);e.ignoreColor=!0,this.editor.graph.model.execute(e)});var e=mxUtils.prompt(mxResources.get("backgroundImage"),"");if(null!=e&&e.length>0){var i=new Image;i.onload=function(){t(new mxImage(e,i.width,i.height))},i.onerror=function(){t(null),mxUtils.alert(mxResources.get("fileNotFound"))},i.src=e}else t(null)},EditorUi.prototype.setBackgroundImage=function(t){this.editor.graph.setBackgroundImage(t),this.editor.graph.view.validateBackgroundImage(),this.fireEvent(new mxEventObject("backgroundImageChanged"))},EditorUi.prototype.confirm=function(t,e,i){mxUtils.confirm(t)?null!=e&&e():null!=i&&i()},EditorUi.prototype.createOutline=function(t){var e=new mxOutline(this.editor.graph);return e.border=20,mxEvent.addListener(window,"resize",function(){e.update()}),this.addListener("pageFormatChanged",function(){e.update()}),e},EditorUi.prototype.createKeyHandler=function(t){function e(t,e,i){l.push(function(){if(!n.isSelectionEmpty()&&n.isEnabled())if(e=null!=e?e:1,i){n.getModel().beginUpdate();try{for(var r=n.getSelectionCells(),a=0;a<r.length;a++)if(n.getModel().isVertex(r[a])&&n.isCellResizable(r[a])){var l=n.getCellGeometry(r[a]);null!=l&&(l=l.clone(),37==t?l.width=Math.max(0,l.width-e):38==t?l.height=Math.max(0,l.height-e):39==t?l.width+=e:40==t&&(l.height+=e),n.getModel().setGeometry(r[a],l))}}finally{n.getModel().endUpdate()}}else{var o=n.getSelectionCell(),s=n.model.getParent(o),h=null;if(1==n.getSelectionCount()&&n.model.isVertex(o)&&null!=n.layoutManager&&!n.isCellLocked(o)&&(h=n.layoutManager.getLayout(s)),null!=h&&h.constructor==mxStackLayout){var d=s.getIndex(o);37==t||38==t?n.model.add(s,o,Math.max(0,d-1)):(39==t||40==t)&&n.model.add(s,o,Math.min(n.model.getChildCount(s),d+1))}else{var c=0,g=0;37==t?c=-e:38==t?g=-e:39==t?c=e:40==t&&(g=e),n.moveCells(n.getMovableCells(n.getSelectionCells()),c,g)}}}),null!=o&&window.clearTimeout(o),o=window.setTimeout(function(){if(l.length>0){n.getModel().beginUpdate();try{for(var t=0;t<l.length;t++)l[t]();l=[]}finally{n.getModel().endUpdate()}n.scrollCellToVisible(n.getSelectionCell())}},200)}var i=this,n=this.editor.graph,r=new mxKeyHandler(n),a=r.isEventIgnored;r.isEventIgnored=function(t){return(!this.isControlDown(t)||mxEvent.isShiftDown(t)||90!=t.keyCode&&89!=t.keyCode&&188!=t.keyCode&&190!=t.keyCode&&85!=t.keyCode)&&(66!=t.keyCode&&73!=t.keyCode||!this.isControlDown(t)||this.graph.cellEditor.isContentEditing()&&!mxClient.IS_FF&&!mxClient.IS_SF)&&a.apply(this,arguments)},r.isEnabledForEvent=function(t){return!mxEvent.isConsumed(t)&&this.isGraphEvent(t)&&this.isEnabled()&&(null==i.dialogs||0==i.dialogs.length)},r.isControlDown=function(t){return mxEvent.isControlDown(t)||mxClient.IS_MAC&&t.metaKey};var l=[],o=null,s={37:mxConstants.DIRECTION_WEST,38:mxConstants.DIRECTION_NORTH,39:mxConstants.DIRECTION_EAST,40:mxConstants.DIRECTION_SOUTH},h=r.getFunction;mxKeyHandler.prototype.getFunction=function(t){if(n.isEnabled()){if(mxEvent.isShiftDown(t)&&mxEvent.isAltDown(t)){var r=i.actions.get(i.altShiftActions[t.keyCode]);if(null!=r)return r.funct}if(9==t.keyCode&&mxEvent.isAltDown(t))return mxEvent.isShiftDown(t)?function(){n.selectParentCell()}:function(){n.selectChildCell()};if(null!=s[t.keyCode]&&!n.isSelectionEmpty()){if(!mxEvent.isShiftDown(t)||!mxEvent.isAltDown(t))return this.isControlDown(t)?function(){e(t.keyCode,mxEvent.isShiftDown(t)?n.gridSize:null,!0)}:function(){e(t.keyCode,mxEvent.isShiftDown(t)?n.gridSize:null)};if(n.model.isVertex(n.getSelectionCell()))return function(){var e=n.connectVertex(n.getSelectionCell(),s[t.keyCode],n.defaultEdgeLength,t,!0);null!=e&&e.length>0&&(1==e.length&&n.model.isEdge(e[0])?n.setSelectionCell(n.model.getTerminal(e[0],!1)):n.setSelectionCell(e[e.length-1]),n.scrollCellToVisible(n.getSelectionCell()),null!=i.hoverIcons&&i.hoverIcons.update(n.view.getState(n.getSelectionCell())))}}}return h.apply(this,arguments)},r.bindAction=mxUtils.bind(this,function(t,e,i,n){var a=this.actions.get(i);if(null!=a){var l=function(){a.isEnabled()&&a.funct()};e?n?r.bindControlShiftKey(t,l):r.bindControlKey(t,l):n?r.bindShiftKey(t,l):r.bindKey(t,l)}});var d=r.escape;return r.escape=function(t){d.apply(this,arguments)},r.enter=function(){},r},EditorUi.prototype.destroy=function(){if(null!=this.editor&&(this.editor.destroy(),this.editor=null),null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),null!=this.sidebar&&(this.sidebar.destroy(),this.sidebar=null),null!=this.keyHandler&&(this.keyHandler.destroy(),this.keyHandler=null),null!=this.keydownHandler&&(mxEvent.removeListener(document,"keydown",this.keydownHandler),this.keydownHandler=null),null!=this.keyupHandler&&(mxEvent.removeListener(document,"keyup",this.keyupHandler),this.keyupHandler=null),null!=this.resizeHandler&&(mxEvent.removeListener(window,"resize",this.resizeHandler),this.resizeHandler=null),null!=this.gestureHandler&&(mxEvent.removeGestureListeners(document,this.gestureHandler),this.gestureHandler=null),null!=this.orientationChangeHandler&&(mxEvent.removeListener(window,"orientationchange",this.orientationChangeHandler),this.orientationChangeHandler=null),null!=this.scrollHandler&&(mxEvent.removeListener(window,"scroll",this.scrollHandler),this.scrollHandler=null),null!=this.destroyFunctions){for(var t=0;t<this.destroyFunctions.length;t++)this.destroyFunctions[t]();this.destroyFunctions=null}for(var e=[this.toolbarContainer,this.diagramContainer,this.chromelessToolbar,this.hsplit,this.layersDialog],t=0;t<e.length;t++)null!=e[t]&&null!=e[t].parentNode&&e[t].parentNode.removeChild(e[t])},EditorUi.prototype.resetHistory=function(){this.editor.undoManager.clear(),this.editor.graph.oldOptArr=[],this.editor.graph.newOptArr=[],this.editor.graph.edgeArr=[]};var topAreaHide=!1,leftAreaHide=!1,rightAreaHide=!1,old_toolbar_height,old_leftArea_width,old_rightArea_width;EditorUi.prototype.toolBarH_S=function(){var t=$("#detailContainer"),e=$("#accordion"),i=$("#graphContainer"),n=$("#geHsplit"),r=$("#geToolbarContainer");topAreaHide?($("#geToolbarContainer>.menu").show(),$("#H_S_Menu>ul>li:eq(0)").html("折叠上方区域"),$("#geToolbarContainer").height(old_toolbar_height+"px"),t.css({height:t.height()-90+"px",bottom:t.height()-90+"px"}),e.css({height:e.height()-90+"px"}),i.css({height:i.height()-90+"px"}),n.css({height:n.height()-90+"px",bottom:n.height()-90+"px"}),this.toolbarHeight=120,topAreaHide=!1):(old_toolbar_height=r.height(),$("#geToolbarContainer>.menu").hide(),$("#H_S_Menu>ul>li:eq(0)").html("展开上方区域"),r.height("20px"),t.css({height:t.height()+90+"px",bottom:t.height()+90+"px"}),e.css({height:e.height()+90+"px"}),i.css({height:i.height()+90+"px"}),n.css({height:n.height()+90+"px",bottom:n.height()+90+"px"}),this.toolbarHeight=30,topAreaHide=!0)},EditorUi.prototype.leftAreaH_S=function(){var t=$("#accordion"),e=$("#geHsplit"),i=$("#geVsplit"),n=$("#graphContainer"),r=n.position().left;leftAreaHide?(t.show(),e.show(),$("#H_S_Menu>ul>li:eq(1)").html("折叠左侧区域"),n.css({width:n.width()-old_leftArea_width-this.splitSize+"px",left:old_leftArea_width+this.splitSize+"px"}),i.css({width:i.width()-old_leftArea_width-this.splitSize+"px",left:r+old_leftArea_width+this.splitSize+"px"}),this.hsplitPosition=old_leftArea_width+this.splitSize,leftAreaHide=!1):(old_leftArea_width=t.width(),t.hide(),e.hide(),$("#H_S_Menu>ul>li:eq(1)").html("展开左侧区域"),n.css({width:n.width()+old_leftArea_width+this.splitSize+"px",left:"0"}),i.css({width:i.width()+old_leftArea_width+this.splitSize+"px",left:r-old_leftArea_width-this.splitSize+"px"}),this.hsplitPosition=0,leftAreaHide=!0)},EditorUi.prototype.rightAreaH_S=function(){var t=$("#detailContainer"),e=$("#geVsplit"),i=$("#graphContainer");i.position().left;rightAreaHide?(t.show(),$("#H_S_Menu>ul>li:eq(2)").html("折叠右侧区域"),i.css({width:i.width()-old_rightArea_width+"px",right:old_rightArea_width+15+"px"}),e.css({width:e.width()-old_rightArea_width+"px"}),rightAreaHide=!1):(old_rightArea_width=t.width(),t.hide(),$("#H_S_Menu>ul>li:eq(2)").html("展开右侧区域"),i.css({width:i.width()+old_rightArea_width+"px",right:"14px"}),e.css({width:e.width()+old_rightArea_width+"px"}),rightAreaHide=!0)};var iconDrag=function(t){var e=getDataSourceTable(),i=!1;$.inArray(t.name,e)>-1&&(i=!0);var n=function(e,n,r,a,l){var o=createCellShape(t.type,i),s=new mxCell(t.name,new mxGeometry(0,0,60,80),o);s.vertex=!0,s.nodeType=t.type;var h={id:s.id,name:t.name,type:t.type,english:t.english||""};initNodeData(h,!0);var d=e.importCells([s],a,l,r);e.curCell=s;var c="拖入【"+t.name+"】";if("datasource"===s.nodeType){if(e.nodeData[s.id].treeNodeId=t.id,e.isCreateTableNodeError=e.preExeGetFields(s,t),e.isCreateTableNodeError)return e.oldOptArr.push({optType:"drag",optArr:[{id:s.id,nodeData:e.nodeData[s.id]}]}),ownerEditor.editor.undoManager.undo(),ownerEditor.editor.undoManager.history.pop(),void delete e.isCreateTableNodeError;i&&(setDataSourceCopyIcon(s.id),e.nodeData[s.id].isCopy=!0),c="拖入表【"+t.name+"】"}if(e.oldOptArr.push({optType:"drag",optArr:[{id:s.id,nodeData:e.nodeData[s.id]}]}),refrashResourceZtree(s.id,t.name,s.nodeType),refrashHistoryZtree(c),autoSaveGraph(),e.getModel().root.children[0].children.length>=2){var g=e.getModel().root.children[0].children[e.getModel().root.children[0].children.length-2];g.nodeType||(g=e.getModel().root.children[0].children[e.getModel().root.children[0].children.length-3]);var p=d[0],u=e.insertEdge(e.getDefaultParent(),null,getEdgeCount()+1,g,d[0],"rounded=0;html=1;jettySize=auto;orthogonalLoop=1;strokeColor=#3E6F96;strokeWidth=2;");if(!edgeVerify(u))return;e.edgeArr[u.id]||(e.edgeArr[u.id]={source:g,target:p}),e.nodeData[g.id].childrenIds.push(p.id),e.nodeData[p.id].parentIds.push(g.id)}},r=document.createElement("div");switch(r.className="geItem",r.style.border="1px solid red",r.style.width="60px",r.style.height="60px",t.type){case"filter":case"sort":case"sample":case"layering":case"groupCount":case"delRepeat":case"comparison":case"change":case"union":case"sql":case"newNullNode":case"relation":mxUtils.makeDraggable($("#"+t.id)[0],graph,n,r,null,null,!0,!0);break;case"datasource":mxUtils.makeDraggable($("#"+t.tId+"_a")[0],graph,n,r,null,null,!0,!0)}},initNodeData=function(t,e){var i={settingId:(new UUIDGenerator).id},n=!1,r=!1,a={nodeId:t.id,nodeName:t.name,optType:t.type,isCreateTable:0,nodeExcuteStatus:1,nodeDescription:"",resultTableName:""};switch(t.type){case"datasource":n=!0,t.english?a.resultTableName=t.english:a.resultTableName=t.name,a.nodeExcuteStatus=3,delete i.settingId;break;case"newNullNode":a.resultTableStatus=1,a.midTableStatus=1;break;case"barChart":delete i.settingId;break;case"layering":a.resultTableNameArr=[],a.nodeSqlArr=[],a.selectSqlNotViewTableArr=[],i.index=0;break;case"comparison":a.dataTableName=""}graph.nodeData[t.id]={isSet:n,isChangeSource:r,setting:i,parentIds:[],childrenIds:[],columnsInfo:[],nodeInfo:a},e&&changeNodeIcon(a.nodeExcuteStatus,n,t.id),graph.scrollCellToVisible(graph.getModel().getCell(t.id)),graph.setSelectionCells(graph.getModel().getCell(t.id))},createCellShape=function(t,e){var i="";switch(t){case"newNullNode":i=IMAGE_PATH+"/table.png";break;case"datasource":i=e?IMAGE_PATH+"/table_copy.png":IMAGE_PATH+"/table.png";break;case"sql":case"filter":case"sort":case"sample":case"layering":case"groupCount":case"delRepeat":case"comparison":case"change":case"union":case"relation":case"barChart":i=IMAGE_PATH+"/"+t+".png"}return"shape=label;image="+i+";whiteSpace=wrap;indicatorColor=#FF0000;verticalLabelPosition=bottom;verticalAlign=top;imageVerticalAlign=top;imageAlign=center;strokeColor=transparent;imageWidth=50;imageHeight=50;spacingTop=-45"},getEdgeCount=function(){for(var t=graph.getDefaultParent(),e=t.children,i=0,n=0;n<e.length;n++)e[n].edge&&i++;return i},toolCellInitSql=function(t){if("undefined"!=typeof t&&t.edge){var e=!1;if(!edgeVerify(t))return;if(graph.edgeArr[t.id]){var i=graph.edgeArr[t.id].source,n=graph.edgeArr[t.id].target;if(graph.nodeData[i.id]&&i.id!==t.source.id||graph.nodeData[n.id]&&n.id!==t.target.id){if(graph.nodeData[i.id]){var r=graph.nodeData[i.id].childrenIds;if($.inArray(n.id,r)>-1){var a=$.inArray(n.id,r);graph.nodeData[i.id].childrenIds.splice(a,1)}}if(graph.nodeData[n.id]){var l=graph.nodeData[n.id].parentIds;if($.inArray(i.id,l)>-1){var a=$.inArray(i.id,l);graph.nodeData[n.id].parentIds.splice(a,1)}}$.inArray(t.source.id,graph.nodeData[t.target.id].parentIds)<0&&graph.nodeData[t.target.id].parentIds.push(t.source.id),$.inArray(t.target.id,graph.nodeData[t.source.id].childrenIds)<0&&graph.nodeData[t.source.id].childrenIds.push(t.target.id),changeNodeInfo(t.target.id,!0),changeNodeInfo(n.id,!0),e=!0}}else $.inArray(t.source.id,graph.nodeData[t.target.id].parentIds)<0&&graph.nodeData[t.target.id].parentIds.push(t.source.id),$.inArray(t.target.id,graph.nodeData[t.source.id].childrenIds)<0&&graph.nodeData[t.source.id].childrenIds.push(t.target.id),e=!0;if(e){var o="";null!=t.value||t.value?o="改变线":(graph.cellLabelChanged(t,""+getEdgeCount(),null),ownerEditor.editor.undoManager.indexOfNextAdd-=1,ownerEditor.editor.undoManager.history.pop(),o="生成线"),refrashHistoryZtree(o+"【"+t.value+"】"),autoSaveGraph(),graph.edgeArr[t.id]={source:t.source,target:t.target}}}};