function Toolbar(editorUi,container){this.editorUi=editorUi;this.container=container;this.initZoom();this.initZoomIn();this.initZoomOut();this.initUndo();this.initRedo();this.initIntersect();this.initUnion();this.initExclude();this.initRelation();this.initNewNullNode();this.initSQL()}Toolbar.prototype.dropdownImage=(!mxClient.IS_SVG)?IMAGE_PATH+"/dropdown.gif":"data:image/gif;base64,R0lGODlhDQANAIABAHt7e////yH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4wLWMwNjAgNjEuMTM0Nzc3LCAyMDEwLzAyLzEyLTE3OjMyOjAwICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCREM1NkJFMjE0NEMxMUU1ODk1Q0M5MjQ0MTA4QjNDMSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCREM1NkJFMzE0NEMxMUU1ODk1Q0M5MjQ0MTA4QjNDMSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkQzOUMzMjZCMTQ0QjExRTU4OTVDQzkyNDQxMDhCM0MxIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkQzOUMzMjZDMTQ0QjExRTU4OTVDQzkyNDQxMDhCM0MxIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEAQAAAQAsAAAAAA0ADQAAAhGMj6nL3QAjVHIu6azbvPtWAAA7";Toolbar.prototype.dropdownImageHtml='<img border="0" style="position:absolute;right:4px;top:'+((!EditorUi.compactUi)?8:6)+'px;" src="'+Toolbar.prototype.dropdownImage+'" valign="middle"/>';Toolbar.prototype.selectedBackground="#d0d0d0";Toolbar.prototype.unselectedBackground="none";Toolbar.prototype.initIntersect=function(){var item=this.addItems(["intersect"])[0];var intersectInterval=setInterval(function(){if(document.getElementById(item.id)!=null){iconDrag({type:"intersect",shape:"hexagon",id:"intersect",tId:item.id,name:item.title});clearInterval(intersectInterval)}},100)};Toolbar.prototype.initUnion=function(){var item=this.addItems(["union"])[0];var unionInterval=setInterval(function(){if(document.getElementById(item.id)!=null){iconDrag({type:"union",shape:"hexagon",id:"union",tId:item.id,name:item.title});clearInterval(unionInterval)}},100)};Toolbar.prototype.initExclude=function(){var item=this.addItems(["exclude"])[0];var excludeInterval=setInterval(function(){if(document.getElementById(item.id)!=null){iconDrag({type:"exclude",shape:"hexagon",id:"exclude",tId:item.id,name:item.title});clearInterval(excludeInterval)}},100)};Toolbar.prototype.initRelation=function(){var item=this.addItems(["relation"])[0];var relationInterval=setInterval(function(){if(document.getElementById(item.id)!=null){iconDrag({type:"relation",shape:"rhombus",id:"relation",tId:item.id,name:item.title});clearInterval(relationInterval)}},100)};Toolbar.prototype.initNewNullNode=function(){var item=this.addItems(["newNullNode"])[0];var newNullNodeInterval=setInterval(function(){if(document.getElementById(item.id)!=null){iconDrag({type:"newNullNode",shape:"rhombus",id:"newNullNode",tId:item.id,name:item.title});clearInterval(newNullNodeInterval)}},100)};Toolbar.prototype.initSQL=function(){var item=this.addItems(["SQL"])[0];var newSQLInterval=setInterval(function(){if(document.getElementById(item.id)!=null){iconDrag({type:"sql",shape:"rhombus",id:"sql",tId:item.id,name:item.title});clearInterval(newSQLInterval)}},100)};Toolbar.prototype.initZoom=function(){var viewMenu=this.addMenu("",mxResources.get("zoom")+" (Alt+Mousewheel)",true,"viewZoom",null,true);viewMenu.showDisabled=true;viewMenu.style.whiteSpace="nowrap";viewMenu.style.position="relative";viewMenu.style.overflow="hidden";viewMenu.style.width="60px";this.updateZoom=mxUtils.bind(this,function(){viewMenu.innerHTML=Math.round(this.editorUi.editor.graph.view.scale*100)+"%"+this.dropdownImageHtml;if(EditorUi.compactUi){viewMenu.getElementsByTagName("img")[0].style.right="1px";viewMenu.getElementsByTagName("img")[0].style.top="5px"}});this.editorUi.editor.graph.view.addListener(mxEvent.EVENT_SCALE,this.updateZoom);this.editorUi.editor.addListener("resetGraphView",this.updateZoom)};Toolbar.prototype.initZoomIn=function(){var elts=this.addItems(["zoomIn"]);elts[0].setAttribute("title",mxResources.get("zoomIn")+" ("+this.editorUi.actions.get("zoomIn").shortcut+")")};Toolbar.prototype.initZoomOut=function(){var elts=this.addItems(["zoomOut"]);elts[0].setAttribute("title",mxResources.get("zoomOut")+" ("+this.editorUi.actions.get("zoomOut").shortcut+")")};
Toolbar.prototype.initUndo=function(){var elts=this.addItems(["undo"]);elts[0].setAttribute("title",mxResources.get("undo")+" ("+this.editorUi.actions.get("undo").shortcut+")")};Toolbar.prototype.initRedo=function(){var elts=this.addItems(["redo"]);elts[0].setAttribute("title",mxResources.get("redo")+" ("+this.editorUi.actions.get("redo").shortcut+")")};Toolbar.prototype.initDelete=function(){var elts=this.addItems(["delete"]);elts[0].setAttribute("title",mxResources.get("delete")+" ("+this.editorUi.actions.get("delete").shortcut+")")};Toolbar.prototype.initToFront=function(){this.addItems(["toFront"])};Toolbar.prototype.initToBack=function(){this.addItems(["toBack"])};Toolbar.prototype.initFillColor=function(){this.addItems(["fillColor"])};Toolbar.prototype.initStrokeColor=function(){this.addItems(["strokeColor"])};Toolbar.prototype.initWaypoints=function(){this.edgeStyleMenu=this.addMenuFunction("geSprite-orthogonal",mxResources.get("waypoints"),false,mxUtils.bind(this,function(menu){this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],[null,null,null],"geIcon geSprite geSprite-straight",null,true).setAttribute("title",mxResources.get("straight"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["orthogonalEdgeStyle",null,null],"geIcon geSprite geSprite-orthogonal",null,true).setAttribute("title",mxResources.get("orthogonal"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["orthogonalEdgeStyle","1",null],"geIcon geSprite geSprite-curved",null,true).setAttribute("title",mxResources.get("curved"))}));this.addDropDownArrow(this.edgeStyleMenu,"geSprite-orthogonal",44,50,0,0,22,-4)};Toolbar.prototype.addDropDownArrow=function(menu,sprite,width,atlasWidth,left,top,atlasDelta,atlasLeft){atlasDelta=(atlasDelta!=null)?atlasDelta:32;left=(EditorUi.compactUi)?left:atlasLeft;menu.style.whiteSpace="nowrap";menu.style.overflow="hidden";menu.style.position="relative";menu.innerHTML='<div class="geSprite '+sprite+'" style="margin-left:'+left+"px;margin-top:"+top+'px;"></div>'+this.dropdownImageHtml;menu.style.width=(mxClient.IS_QUIRKS)?atlasWidth+"px":(atlasWidth-atlasDelta)+"px";if(mxClient.IS_QUIRKS){menu.style.height=(EditorUi.compactUi)?"24px":"26px"}if(EditorUi.compactUi){menu.getElementsByTagName("img")[0].style.left="24px";menu.getElementsByTagName("img")[0].style.top="5px";menu.style.width=(mxClient.IS_QUIRKS)?width+"px":(width-10)+"px"}};Toolbar.prototype.setFontName=function(value){if(this.fontMenu!=null){this.fontMenu.innerHTML='<div style="width:60px;overflow:hidden;display:inline-block;">'+mxUtils.htmlEntities(value)+"</div>"+this.dropdownImageHtml}};Toolbar.prototype.setFontSize=function(value){if(this.sizeMenu!=null){this.sizeMenu.innerHTML='<div style="width:24px;overflow:hidden;display:inline-block;">'+value+"</div>"+this.dropdownImageHtml}};Toolbar.prototype.hideMenu=function(){this.editorUi.hideCurrentMenu()};Toolbar.prototype.addMenu=function(label,tooltip,showLabels,name,c,showAll,ignoreState){var menu=this.editorUi.menus.get(name);var elt=this.addMenuFunction(label,tooltip,showLabels,function(){menu.funct.apply(menu,arguments)},c,showAll);return elt};Toolbar.prototype.addMenuFunction=function(label,tooltip,showLabels,funct,c,showAll){return this.addMenuFunctionInContainer((c!=null)?c:this.container,label,tooltip,showLabels,funct,showAll)};Toolbar.prototype.addMenuFunctionInContainer=function(container,label,tooltip,showLabels,funct,showAll){var elt=(showLabels)?this.createLabel(label):this.createButton(label);this.initElement(elt,tooltip);this.addMenuHandler(elt,showLabels,funct,showAll);container.appendChild(elt);return elt};Toolbar.prototype.addSeparator=function(c){c=(c!=null)?c:this.container;var elt=document.createElement("div");elt.className="geSeparator";c.appendChild(elt);return elt};Toolbar.prototype.addItems=function(keys,c,ignoreDisabled){var items=[];for(var i=0;i<keys.length;i++){var key=keys[i];if(key=="-"){items.push(this.addSeparator(c))}else{items.push(this.addItem("geSprite-"+key.toLowerCase(),key,c,ignoreDisabled))}}return items};Toolbar.prototype.addItem=function(sprite,key,c,ignoreDisabled){var action=this.editorUi.actions.get(key);var elt=null;if(action!=null){var tooltip=action.label;if(action.shortcut!=null){tooltip+=" ("+action.shortcut+")"}elt=this.addButton(sprite,tooltip,action.funct,c);if(!ignoreDisabled){elt.setEnabled(action.enabled);action.addListener("stateChanged",function(){elt.setEnabled(action.enabled)})}}return elt};Toolbar.prototype.addButton=function(classname,tooltip,funct,c){var elt=this.createButton(classname);c=(c!=null)?c:this.container;this.initElement(elt,tooltip);this.addClickHandler(elt,funct);c.appendChild(elt);return elt};Toolbar.prototype.initElement=function(elt,tooltip){if(tooltip!=null){elt.setAttribute("title",tooltip)}this.addEnabledState(elt)
};Toolbar.prototype.addEnabledState=function(elt){var classname=elt.className;elt.setEnabled=function(value){elt.enabled=value;if(value){elt.className=classname}else{elt.className=classname+" mxDisabled"}};elt.setEnabled(true)};Toolbar.prototype.addClickHandler=function(elt,funct){if(funct!=null){mxEvent.addListener(elt,"click",function(evt){if(elt.enabled){funct(evt)}mxEvent.consume(evt)});mxEvent.addListener(elt,(mxClient.IS_POINTER)?"pointerdown":"mousedown",mxUtils.bind(this,function(evt){evt.preventDefault()}))}};Toolbar.prototype.createButton=function(classname){var elt=document.createElement("a");elt.className="geButton";elt.id=mxUtils.uuid();var inner=document.createElement("div");if(classname!=null){inner.className="geSprite "+classname}elt.appendChild(inner);return elt};Toolbar.prototype.createLabel=function(label,tooltip){var elt=document.createElement("a");elt.className="geLabel";mxUtils.write(elt,label);return elt};Toolbar.prototype.addMenuHandler=function(elt,showLabels,funct,showAll){if(funct!=null){var graph=this.editorUi.editor.graph;var menu=null;var show=true;mxEvent.addListener(elt,"click",mxUtils.bind(this,function(evt){if(show&&(elt.enabled==null||elt.enabled)){graph.popupMenuHandler.hideMenu();menu=new mxPopupMenu(funct);menu.div.className+=" geToolbarMenu";menu.showDisabled=showAll;menu.labels=showLabels;menu.autoExpand=true;var offset=mxUtils.getOffset(elt);menu.popup(offset.x,offset.y+elt.offsetHeight,null,evt);this.editorUi.setCurrentMenu(menu,elt);if(!showLabels&&menu.div.scrollHeight>menu.div.clientHeight){menu.div.style.width="40px"}menu.hideMenu=mxUtils.bind(this,function(){mxPopupMenu.prototype.hideMenu.apply(menu,arguments);this.editorUi.resetCurrentMenu();menu.destroy()});menu.addListener(mxEvent.EVENT_HIDE,mxUtils.bind(this,function(){this.currentElt=null}))}show=true;mxEvent.consume(evt)}));mxEvent.addListener(elt,(mxClient.IS_POINTER)?"pointerdown":"mousedown",mxUtils.bind(this,function(evt){show=this.currentElt!=elt;evt.preventDefault()}))}};Toolbar.prototype.destroy=function(){if(this.gestureHandler!=null){mxEvent.removeGestureListeners(document,this.gestureHandler);this.gestureHandler=null}};
