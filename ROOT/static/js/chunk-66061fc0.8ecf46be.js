(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66061fc0"],{"0777":function(t,e,a){"use strict";a.r(e);var l=a("f25e"),i=a("d709");for(var n in i)["default"].indexOf(n)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(n);a("cb4d");var o=a("0c7c"),u=Object(o["a"])(i["default"],l["a"],l["b"],!1,null,"459ad71f",null);e["default"]=u.exports},7065:function(t,e,a){"use strict";var l=a("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("4917"),a("7514");var i=l(a("b775")),n=l(a("1157")),o=(a("5c96"),l(a("56b3")));a("a7be"),a("a8d9"),a("f9d4"),a("693d");var u={name:"editCalculationcolumn",props:["tableId","tableName","calculationColId","rawTableName"],components:{seeSqlData:function(t){return a.e("chunk-3317cbda").then(function(){var e=[a("7adc")];t.apply(null,e)}.bind(this)).catch(a.oe)}},data:function(){return{editor:null,editData:{},form:{columnAlias:"",code:"",tableName:""},colList:[],seeSqlDataDialog:!1,seeDataSql:""}},mounted:function(){this.initData(),this.getTableColumn(this.tableId)},created:function(){},methods:{initData:function(){void 0==this.calculationColId||this.antiDisplayCalcuationCol(this.calculationColId),(0,n.default)("#tableName").attr("value",decodeURI(this.tableName)),this.editor=o.default.fromTextArea(document.getElementById("code"),{lineNumbers:!0,indentUnit:4,styleActiveLine:!0,matchBrackets:!0,mode:"htmlmixed",lineWrapping:!0})},getTableColumn:function(t){var e=this;(0,n.default)("#colName").html(""),(0,i.default)({baseURL:this.dataContextUrl,url:"/tableMeta/getCols",method:"post",params:{tableMetaUuid:t,isEnclose:"-1"}}).then((function(t){n.default.each(t.data,(function(t,a){e.colList.push(a.colName);for(var l=(0,n.default)("<li id='"+a.colMetaUuid+" '>"+a.colName+"</li>"),i=0;i<l.length;i++)l[i].onclick=e.setStyle,l[i].ondragstart=e.ulDragStart,l[i].draggable=!0,l[i].ondragend=e.ulDragEnd;(0,n.default)("#colName").append(l)}))}))},setStyle:function(t){(0,n.default)("#colName li").removeClass(),(0,n.default)(t.target).addClass("selected")},ulDragStart:function(){},ulDragEnd:function(t){t.target.id;var e=t.target.textContent;this.editor.replaceSelection(e)},saveCalculationCol:function(){void 0==this.calculationColId?this.save():this.update()},save:function(){var t=this,e=(0,n.default)("#columnAlias").val();if(t.verEml()){var a=this.tableId,l={inCalculationColumnUuid:this.getuuid(),calculationColumnTableid:a,calculationColumnSql:this.editor.getValue(),createTime:"",updateTime:"",createPersonUuid:"",createPersonName:"",belongOrg:"",belongType:"",calculationColumnName:e},i=this.contextUrl+"/InCalculationColumn/insertSelective";n.default.post(i,{inCalculationColumn:JSON.stringify(l)},(function(e){0!=e.state?(t.$emit("getAllColumn",a),t.closeDialog()):t.$message(e.message)}),"json")}},update:function(){var t=this;if(t.verEml()){var e=this.tableId;this.editData.calculationColumnName=(0,n.default)("#columnAlias").val(),this.editData.calculationColumnSql=t.editor.getValue(),this.editData.createTime="",this.editData.updateTime="";var a=this.contextUrl+"/InCalculationColumn/updateByPrimaryKeySelective";n.default.post(a,{inCalculationColumn:JSON.stringify(this.editData)},(function(a){0!=a.state?(t.$emit("getAllColumn",e),t.closeDialog()):t.$message(a.message)}),"json")}},verEml:function(){var t=(0,n.default)("#columnAlias").val(),e=this.editor.getValue();return""==t?(this.$message("名称不能为空！"),!1):t.length>50?(this.$message("名称不能大于50个字符！"),!1):""!=e||(this.$message("公式不能为空！"),!1)},antiDisplayCalcuationCol:function(t){var e=this,a=this.contextUrl+"/InCalculationColumn/selectByPrimaryKey";n.default.post(a,{inCalculationColumnUuid:t},(function(t){e.editData=t,(0,n.default)("#columnAlias").attr("value",t.calculationColumnName),e.editor.replaceSelection(t.calculationColumnSql)}),"json")},closeDialog:function(){this.$emit("closeCalculationcolumn")},seeSqlData:function(){var t="",e=this.editor.getValue();if(""!==e){n.default.each(this.colList,(function(a,l){-1!=e.indexOf(l)&&(t+=l+",")}));var a=this.rawTableName;t=t.substring(0,t.length-1),t+=","+this.editor.getValue()+" as 结果预览";var l="select {0} from {1}".format(t,a);this.seeDataSql=l,this.seeSqlDataDialog=!0}},searchOnChange:function(){var t=(0,n.default)("#searchColumn").val(),e=(0,n.default)("#colName").find("li");e.each((function(e){var a=(0,n.default)(this),l=a.text();l.match(t)?a.show():a.hide()}))}}};e.default=u},"9de0":function(t,e,a){},cb4d:function(t,e,a){"use strict";a("9de0")},d709:function(t,e,a){"use strict";a.r(e);var l=a("7065"),i=a.n(l);for(var n in l)["default"].indexOf(n)<0&&function(t){a.d(e,t,(function(){return l[t]}))}(n);e["default"]=i.a},f25e:function(t,e,a){"use strict";a.d(e,"a",(function(){return l})),a.d(e,"b",(function(){return i}));var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("el-aside",[a("ul",{attrs:{id:"colName"}})]),a("el-container",[a("el-main",[a("el-form",[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{id:"columnAlias"},model:{value:t.form.columnAlias,callback:function(e){t.$set(t.form,"columnAlias",e)},expression:"form.columnAlias"}})],1),a("el-form-item",{attrs:{label:"表名"}},[a("el-input",{attrs:{id:"tableName",readonly:"readonly"},model:{value:t.form.tableName,callback:function(e){t.$set(t.form,"tableName",e)},expression:"form.tableName"}})],1),a("el-form-item",{attrs:{label:"维度计算"}},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.code,expression:"form.code"}],attrs:{id:"code",name:"code"},domProps:{value:t.form.code},on:{input:function(e){e.target.composing||t.$set(t.form,"code",e.target.value)}}})])],1)],1),a("el-footer",[a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:t.seeSqlData}},[t._v("查看结果")]),a("el-button",{attrs:{type:"primary"},on:{click:t.saveCalculationCol}},[t._v("保存")]),a("el-button",{attrs:{type:"primary"},on:{click:t.closeDialog}},[t._v("取消")])],1)])],1),t.seeSqlDataDialog?a("el-dialog",{attrs:{"append-to-body":"",title:"查看数据",visible:t.seeSqlDataDialog},on:{"update:visible":function(e){t.seeSqlDataDialog=e}}},[a("seeSqlData",{attrs:{seeDataSql:t.seeDataSql}})],1):t._e()],1)},i=[]}}]);